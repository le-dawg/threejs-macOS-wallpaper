;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="d6051e81-8224-d602-78b1-cd8f658e5d1d")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,605532,877182,e=>{"use strict";e.i(350461);var a,t=Symbol.for("immer-nothing"),i=Symbol.for("immer-draftable"),s=Symbol.for("immer-state");function r(e){for(var a=arguments.length,t=Array(a>1?a-1:0),i=1;i<a;i++)t[i-1]=arguments[i];throw Error("[Immer] minified error nr: ".concat(e,". Full error at: https://bit.ly/3cXEKWf"))}var n=Object.getPrototypeOf;function o(e){return!!e&&!!e[s]}function l(e){var a;return!!e&&(u(e)||Array.isArray(e)||!!e[i]||!!(null==(a=e.constructor)?void 0:a[i])||g(e)||v(e))}var d=Object.prototype.constructor.toString(),c=new WeakMap;function u(e){if(!e||"object"!=typeof e)return!1;let a=Object.getPrototypeOf(e);if(null===a||a===Object.prototype)return!0;let t=Object.hasOwnProperty.call(a,"constructor")&&a.constructor;if(t===Object)return!0;if("function"!=typeof t)return!1;let i=c.get(t);return void 0===i&&(i=Function.toString.call(t),c.set(t,i)),i===d}function h(e,a){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2];0===p(e)?(t?Reflect.ownKeys(e):Object.keys(e)).forEach(t=>{a(t,e[t],e)}):e.forEach((t,i)=>a(i,t,e))}function p(e){let a=e[s];return a?a.type_:Array.isArray(e)?1:g(e)?2:3*!!v(e)}function m(e,a){return 2===p(e)?e.has(a):Object.prototype.hasOwnProperty.call(e,a)}function f(e,a,t){let i=p(e);2===i?e.set(a,t):3===i?e.add(t):e[a]=t}function g(e){return e instanceof Map}function v(e){return e instanceof Set}function x(e){return e.copy_||e.base_}function b(e,a){if(g(e))return new Map(e);if(v(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);let t=u(e);if(!0!==a&&("class_only"!==a||t)){let a=n(e);return null!==a&&t?{...e}:Object.assign(Object.create(a),e)}{let a=Object.getOwnPropertyDescriptors(e);delete a[s];let t=Reflect.ownKeys(a);for(let i=0;i<t.length;i++){let s=t[i],r=a[s];!1===r.writable&&(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(a[s]={configurable:!0,writable:!0,enumerable:r.enumerable,value:e[s]})}return Object.create(n(e),a)}}function _(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return y(e)||o(e)||!l(e)||(p(e)>1&&Object.defineProperties(e,{set:j,add:j,clear:j,delete:j}),Object.freeze(e),a&&Object.values(e).forEach(e=>_(e,!0))),e}var j={value:function(){r(2)}};function y(e){return null===e||"object"!=typeof e||Object.isFrozen(e)}var w={};function C(e){let a=w[e];return a||r(0,e),a}function M(e,a){a&&(C("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=a)}function k(e){T(e),e.drafts_.forEach(N),e.drafts_=null}function T(e){e===a&&(a=e.parent_)}function S(e){return a={drafts_:[],parent_:a,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function N(e){let a=e[s];0===a.type_||1===a.type_?a.revoke_():a.revoked_=!0}function A(e,a){a.unfinalizedDrafts_=a.drafts_.length;let i=a.drafts_[0];return void 0!==e&&e!==i?(i[s].modified_&&(k(a),r(4)),l(e)&&(e=I(a,e),a.parent_||O(a,e)),a.patches_&&C("Patches").generateReplacementPatches_(i[s].base_,e,a.patches_,a.inversePatches_)):e=I(a,i,[]),k(a),a.patches_&&a.patchListener_(a.patches_,a.inversePatches_),e!==t?e:void 0}function I(e,a,t){if(y(a))return a;let i=e.immer_.shouldUseStrictIteration(),r=a[s];if(!r)return h(a,(i,s)=>P(e,r,a,i,s,t),i),a;if(r.scope_!==e)return a;if(!r.modified_)return O(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;let a=r.copy_,s=a,n=!1;3===r.type_&&(s=new Set(a),a.clear(),n=!0),h(s,(i,s)=>P(e,r,a,i,s,t,n),i),O(e,a,!1),t&&e.patches_&&C("Patches").generatePatches_(r,t,e.patches_,e.inversePatches_)}return r.copy_}function P(e,a,t,i,s,r,n){if(null==s||"object"!=typeof s&&!n)return;let d=y(s);if(!d||n){if(o(s)){let n=I(e,s,r&&a&&3!==a.type_&&!m(a.assigned_,i)?r.concat(i):void 0);if(f(t,i,n),!o(n))return;e.canAutoFreeze_=!1}else n&&t.add(s);if(l(s)&&!d){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1||a&&a.base_&&a.base_[i]===s&&d)return;I(e,s),(!a||!a.scope_.parent_)&&"symbol"!=typeof i&&(g(t)?t.has(i):Object.prototype.propertyIsEnumerable.call(t,i))&&O(e,s)}}}function O(e,a){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&_(a,t)}var L={get(e,a){if(a===s)return e;let t=x(e);if(!m(t,a)){var i,r;let s;return i=e,(s=U(t,a))?"value"in s?s.value:null==(r=s.get)?void 0:r.call(i.draft_):void 0}let n=t[a];return e.finalized_||!l(n)?n:n===R(e.base_,a)?(D(e),e.copy_[a]=F(n,e)):n},has:(e,a)=>a in x(e),ownKeys:e=>Reflect.ownKeys(x(e)),set(e,a,t){let i=U(x(e),a);if(null==i?void 0:i.set)return i.set.call(e.draft_,t),!0;if(!e.modified_){let i=R(x(e),a),r=null==i?void 0:i[s];if(r&&r.base_===t)return e.copy_[a]=t,e.assigned_[a]=!1,!0;if((t===i?0!==t||1/t==1/i:t!=t&&i!=i)&&(void 0!==t||m(e.base_,a)))return!0;D(e),z(e)}return!!(e.copy_[a]===t&&(void 0!==t||a in e.copy_)||Number.isNaN(t)&&Number.isNaN(e.copy_[a]))||(e.copy_[a]=t,e.assigned_[a]=!0,!0)},deleteProperty:(e,a)=>(void 0!==R(e.base_,a)||a in e.base_?(e.assigned_[a]=!1,D(e),z(e)):delete e.assigned_[a],e.copy_&&delete e.copy_[a],!0),getOwnPropertyDescriptor(e,a){let t=x(e),i=Reflect.getOwnPropertyDescriptor(t,a);return i?{writable:!0,configurable:1!==e.type_||"length"!==a,enumerable:i.enumerable,value:t[a]}:i},defineProperty(){r(11)},getPrototypeOf:e=>n(e.base_),setPrototypeOf(){r(12)}},E={};function R(e,a){let t=e[s];return(t?x(t):e)[a]}function U(e,a){if(!(a in e))return;let t=n(e);for(;t;){let e=Object.getOwnPropertyDescriptor(t,a);if(e)return e;t=n(t)}}function z(e){!e.modified_&&(e.modified_=!0,e.parent_&&z(e.parent_))}function D(e){e.copy_||(e.copy_=b(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function F(e,t){let i=g(e)?C("MapSet").proxyMap_(e,t):v(e)?C("MapSet").proxySet_(e,t):function(e,t){let i=Array.isArray(e),s={type_:+!!i,scope_:t?t.scope_:a,modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},r=s,n=L;i&&(r=[s],n=E);let{revoke:o,proxy:l}=Proxy.revocable(r,n);return s.draft_=l,s.revoke_=o,l}(e,t);return(t?t.scope_:a).drafts_.push(i),i}function B(){class e extends Map{get size(){return x(this[s]).size}has(e){return x(this[s]).has(e)}set(e,a){let i=this[s];return o(i),x(i).has(e)&&x(i).get(e)===a||(t(i),z(i),i.assigned_.set(e,!0),i.copy_.set(e,a),i.assigned_.set(e,!0)),this}delete(e){if(!this.has(e))return!1;let a=this[s];return o(a),t(a),z(a),a.base_.has(e)?a.assigned_.set(e,!1):a.assigned_.delete(e),a.copy_.delete(e),!0}clear(){let e=this[s];o(e),x(e).size&&(t(e),z(e),e.assigned_=new Map,h(e.base_,a=>{e.assigned_.set(a,!1)}),e.copy_.clear())}forEach(e,a){x(this[s]).forEach((t,i,s)=>{e.call(a,this.get(i),i,this)})}get(e){let a=this[s];o(a);let i=x(a).get(e);if(a.finalized_||!l(i)||i!==a.base_.get(e))return i;let r=F(i,a);return t(a),a.copy_.set(e,r),r}keys(){return x(this[s]).keys()}values(){let e=this.keys();return{[Symbol.iterator]:()=>this.values(),next:()=>{let a=e.next();return a.done?a:{done:!1,value:this.get(a.value)}}}}entries(){let e=this.keys();return{[Symbol.iterator]:()=>this.entries(),next:()=>{let a=e.next();if(a.done)return a;let t=this.get(a.value);return{done:!1,value:[a.value,t]}}}}[Symbol.iterator](){return this.entries()}constructor(e,t){super(),this[s]={type_:2,parent_:t,scope_:t?t.scope_:a,modified_:!1,finalized_:!1,copy_:void 0,assigned_:void 0,base_:e,draft_:this,isManual_:!1,revoked_:!1}}}function t(e){e.copy_||(e.assigned_=new Map,e.copy_=new Map(e.base_))}class i extends Set{get size(){return x(this[s]).size}has(e){let a=this[s];return(o(a),a.copy_)?!!(a.copy_.has(e)||a.drafts_.has(e)&&a.copy_.has(a.drafts_.get(e))):a.base_.has(e)}add(e){let a=this[s];return o(a),this.has(e)||(n(a),z(a),a.copy_.add(e)),this}delete(e){if(!this.has(e))return!1;let a=this[s];return o(a),n(a),z(a),a.copy_.delete(e)||!!a.drafts_.has(e)&&a.copy_.delete(a.drafts_.get(e))}clear(){let e=this[s];o(e),x(e).size&&(n(e),z(e),e.copy_.clear())}values(){let e=this[s];return o(e),n(e),e.copy_.values()}entries(){let e=this[s];return o(e),n(e),e.copy_.entries()}keys(){return this.values()}[Symbol.iterator](){return this.values()}forEach(e,a){let t=this.values(),i=t.next();for(;!i.done;)e.call(a,i.value,i.value,this),i=t.next()}constructor(e,t){super(),this[s]={type_:3,parent_:t,scope_:t?t.scope_:a,modified_:!1,finalized_:!1,copy_:void 0,base_:e,draft_:this,drafts_:new Map,revoked_:!1,isManual_:!1}}}function n(e){e.copy_||(e.copy_=new Set,e.base_.forEach(a=>{if(l(a)){let t=F(a,e);e.drafts_.set(a,t),e.copy_.add(t)}else e.copy_.add(a)}))}function o(e){e.revoked_&&r(3,JSON.stringify(x(e)))}w.MapSet||(w.MapSet={proxyMap_:function(a,t){return new e(a,t)},proxySet_:function(e,a){return new i(e,a)}})}h(L,(e,a)=>{E[e]=function(){return arguments[0]=arguments[0][0],a.apply(this,arguments)}}),E.deleteProperty=function(e,a){return E.set.call(this,e,a,void 0)},E.set=function(e,a,t){return L.set.call(this,e[0],a,t,e[0])};var W=new class{createDraft(e){var a;l(e)||r(8),o(e)&&(o(a=e)||r(10,a),e=function e(a){let t;if(!l(a)||y(a))return a;let i=a[s],r=!0;if(i){if(!i.modified_)return i.base_;i.finalized_=!0,t=b(a,i.scope_.immer_.useStrictShallowCopy_),r=i.scope_.immer_.shouldUseStrictIteration()}else t=b(a,!0);return h(t,(a,i)=>{f(t,a,e(i))},r),i&&(i.finalized_=!1),t}(a));let t=S(this),i=F(e,void 0);return i[s].isManual_=!0,T(t),i}finishDraft(e,a){let t=e&&e[s];t&&t.isManual_||r(9);let{scope_:i}=t;return M(i,a),A(void 0,i)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,a){let t;for(t=a.length-1;t>=0;t--){let i=a[t];if(0===i.path.length&&"replace"===i.op){e=i.value;break}}t>-1&&(a=a.slice(t+1));let i=C("Patches").applyPatches_;return o(e)?i(e,a):this.produce(e,e=>i(e,a))}constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(e,a,i)=>{let s;if("function"==typeof e&&"function"!=typeof a){let t=a;a=e;let i=this;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;for(var s=arguments.length,r=Array(s>1?s-1:0),n=1;n<s;n++)r[n-1]=arguments[n];return i.produce(e,e=>a.call(this,e,...r))}}if("function"!=typeof a&&r(6),void 0!==i&&"function"!=typeof i&&r(7),l(e)){let t=S(this),r=F(e,void 0),n=!0;try{s=a(r),n=!1}finally{n?k(t):T(t)}return M(t,i),A(s,t)}if(e&&"object"==typeof e)r(1,e);else{if(void 0===(s=a(e))&&(s=e),s===t&&(s=void 0),this.autoFreeze_&&_(s,!0),i){let a=[],t=[];C("Patches").generateReplacementPatches_(e,s,a,t),i(a,t)}return s}},this.produceWithPatches=(e,a)=>{let t,i;if("function"==typeof e){var s=this;return function(a){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return s.produceWithPatches(a,a=>e(a,...i))}}return[this.produce(e,a,(e,a)=>{t=e,i=a}),t,i]},"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof(null==e?void 0:e.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),"boolean"==typeof(null==e?void 0:e.useStrictIteration)&&this.setUseStrictIteration(e.useStrictIteration)}}().produce;e.s(["enableMapSet",()=>B,"produce",()=>W],877182);var V=e.i(191788),H=e.i(746349),G=e.i(645935),Y=e.i(322482),q=e.i(974714),K=e.i(729506),Z=e.i(277386),X=e.i(102969),Q=e.i(839746);B();let J=e=>e.api_id,$=e=>"".concat("user",".").concat(e),ee=new class{addEventListener(e,a){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(a)}removeEventListener(e,a){this.listeners.has(e)&&this.listeners.get(e).delete(a)}triggeredEventTypes(e){let a=e.type.split(".")[0];return["".concat(a,"."),e.type]}dispatchEvent(e){for(let a of this.triggeredEventTypes(e))if(this.listeners.has(a))for(let t of this.listeners.get(a))t.call(this,e)}constructor(){(0,H._)(this,"listeners",void 0),this.listeners=new Map}},ea=new Map,et=new Map,ei=()=>new Date(Date.now()-63e3).toISOString(),es=()=>new Date(Date.now()-18e5).toISOString(),er=e=>{let{lastOnlineAt:a,onlineCutoff:t,recentlyOnlineCutoff:i}=e;return a?(t||(t=ei()),i||(i=es()),a<i)?X.UserOnlineStatus.Offline:a<t?X.UserOnlineStatus.RecentlyOnline:X.UserOnlineStatus.Online:X.UserOnlineStatus.Offline},en=e=>{for(let a of e)ea.set(J(a),a.last_online_at)},eo=e=>e&&et.get(J(e))||X.UserOnlineStatus.Offline;e.s(["PresenceProvider",0,e=>{let{user:a,presenceFetcher:t,pause:i}=e,s=(0,q.useStableObject)(a),{data:r,refresh:n}=(0,Y.useRemoteData)({fetcher:t,initialData:null});(0,K.useUpdateEffect)(()=>{(null==s?void 0:s.api_id)&&n()},[null==s?void 0:s.api_id]),(0,G.usePolling)(()=>{(e=>{let{usersStatuses:a,usersLastOnlineAts:t}=e,i=ei(),s=es();for(let[e,r]of t){let t=a.get(e),n=er({lastOnlineAt:r,onlineCutoff:i,recentlyOnlineCutoff:s});t!==n&&(a.set(e,n),ee.dispatchEvent({type:$(e),userKey:e,userOnlineStatus:n}))}ee.dispatchEvent({type:"presenceChangedBatchEnd"})})({usersStatuses:et,usersLastOnlineAts:ea})},1e3),(0,V.useEffect)(()=>{r&&en(r.users)},[r]);let o=(0,V.useCallback)(e=>{e.type===Z.RealTimeUpdateType.ChatUserUpsert&&en([e.user])},[]),l=(0,V.useCallback)(()=>{console.error("Failed to subscribe to real time updates")},[]);return(0,Q.useCentrifugeSubscription)({channel:s?(0,Z.getRealTimeChannelForUserChat)({api_id:s.api_id}):void 0,onUpdate:o,onSubscribe:n,onError:l,pause:i}),null},"usePresence",0,e=>{let[a,t]=(0,V.useState)(()=>eo(e));return(0,V.useEffect)(()=>{if(!e)return;t(eo(e));let a=$(J(e)),i=e=>{e.type===a&&t(e.userOnlineStatus)};return ee.addEventListener(a,i),()=>{ee.removeEventListener(a,i)}},[t,e]),a}],605532)},29992,402818,496712,e=>{"use strict";var a=e.i(391398),t=e.i(359626),i=e.i(272043),s=e.i(260992),r=e.i(605532),n=e.i(687836);let o=e=>{let{info:t,...i}=e,s=(0,r.usePresence)("direct"===t.type?t.other_participant.user:null);return"direct"===t.type?(0,a.jsx)(n.Avatar,{...i,url:t.other_participant.user.avatar_url,status:s}):(0,a.jsx)(l,{conversation:t.conversation,...i})},l=e=>{var i;let{conversation:r,...o}=e,l=(0,s.useRemPx)();if(r.avatar_url)return(0,a.jsx)(n.Avatar,{url:r.avatar_url,...o,isSquare:null!=r.event_api_id});let d="px"in o?o.px:l*o.rem,c="px"in o?o.px?"".concat(o.px,"px"):"inherit":"".concat(o.rem,"rem");return(0,a.jsxs)("div",{style:{width:c,height:c,backgroundColor:null!=(i=r.avatar_hex)?i:void 0},className:"jsx-e39a0faa6ab9d461 conversation-avatar",children:[(0,a.jsx)("div",{style:{fontSize:d/2},className:"jsx-e39a0faa6ab9d461 text",children:r.avatar_text}),(0,a.jsx)(t.default,{id:"e39a0faa6ab9d461",children:".conversation-avatar.jsx-e39a0faa6ab9d461{background-color:var(--cranberry);border-radius:100%;flex-shrink:0;justify-content:center;align-items:center;display:flex}"})]})};e.s(["ChatConversationAvatar",0,o],402818),e.s(["ChatConversationHead",0,e=>{let{info:s,isUnread:r,isActive:n,onClick:l}=e;return(0,a.jsxs)("button",{onClick:l,className:t.default.dynamic([["695b0ca59567604b",[32,32,32,32]]])+" chat-head animated",children:[(0,a.jsx)("div",{className:t.default.dynamic([["695b0ca59567604b",[32,32,32,32]]])+" "+((0,i.default)("head-ring animated",{"head-ring-hidden":!n,event:null!=s.conversation.event_api_id})||"")}),(0,a.jsx)(o,{info:s,px:32}),(0,a.jsx)("div",{className:t.default.dynamic([["695b0ca59567604b",[32,32,32,32]]])+" "+((0,i.default)("unread-indicator animated",{"unread-indicator-hidden":!r})||"")}),(0,a.jsx)(t.default,{id:"695b0ca59567604b",dynamic:[32,32,32,32],children:".chat-head.__jsx-style-dynamic-selector{--button-size:48px;width:var(--button-size);height:var(--button-size);border-radius:var(--button-size);border:none;justify-content:center;align-items:center;padding:0;display:flex;position:relative}.chat-head.__jsx-style-dynamic-selector:hover{background-color:var(--chat-conversation-head-bg-hover-color)}.chat-head.__jsx-style-dynamic-selector:active{background-color:var(--chat-conversation-head-bg-active-color)}.chat-head.__jsx-style-dynamic-selector .avatar-wrapper .avatar{outline:1px solid var(--opacity-light)}.chat-head.__jsx-style-dynamic-selector:focus-visible{outline:var(--chat-conversation-head-active-ring-color)solid 2px;outline-offset:-4px}.head-ring.__jsx-style-dynamic-selector{--size:calc(".concat(32,"px + (var(--button-size) - ").concat(32,"px)/2);width:var(--size);height:var(--size);box-sizing:content-box;border-radius:var(--size);border:2px solid var(--chat-conversation-head-active-ring-color);position:absolute}.head-ring.event.__jsx-style-dynamic-selector{--size:").concat(32,"px;border-radius:calc(var(--border-radius) + 2px)}.head-ring-hidden.__jsx-style-dynamic-selector{opacity:0}.unread-indicator.__jsx-style-dynamic-selector{--avatar-margin:calc((var(--button-size) - ").concat(32,"px)/2);outline:1px solid var(--bg-opacity-80);background:var(--unread-badge-bg-color);width:10px;height:10px;top:calc(var(--avatar-margin) - 1px);right:calc(var(--avatar-margin) - 1px);border-radius:10px;position:absolute}.unread-indicator-hidden.__jsx-style-dynamic-selector{transform:scale(0)}")})]})}],29992);var d=e.i(340180);e.s(["ChatLauncherButton",0,e=>{let{onClick:s,unreadConversationsCount:r=0}=e;return(0,a.jsxs)("button",{onClick:s,className:"jsx-e1a9288d19b2f001 chat-button animated",children:[(0,a.jsx)(d.default,{}),(0,a.jsx)("div",{className:"jsx-e1a9288d19b2f001 "+((0,i.default)("unread-count animated",{"unread-count-hidden":0===r})||""),children:Math.max(r,1)}),(0,a.jsx)(t.default,{id:"e1a9288d19b2f001",children:".chat-button.jsx-e1a9288d19b2f001{z-index:22;width:48px;height:48px;color:var(--chat-main-button-color);box-shadow:var(--chat-box-shadow);background-color:var(--chat-main-button-bg-color);-webkit-backdrop-filter:var(--backdrop-blur);backdrop-filter:var(--backdrop-blur);outline:1px solid var(--opacity-light);border:none;border-radius:48px;justify-content:center;align-items:center;display:flex;position:relative}.chat-button.jsx-e1a9288d19b2f001:hover{background-color:var(--chat-main-button-bg-hover-color);transform:scale(1.05)}.chat-button.jsx-e1a9288d19b2f001:active{background-color:var(--chat-main-button-bg-active-color);transform:scale(1)}.chat-button.jsx-e1a9288d19b2f001:focus-visible{outline:var(--chat-conversation-head-active-ring-color)solid 2px;outline-offset:2px}.chat-button.jsx-e1a9288d19b2f001 svg{width:24px;min-width:24px;height:24px}.unread-count.jsx-e1a9288d19b2f001{border:1px solid var(--unread-badge-border-color);background:var(--unread-badge-bg-color);width:20px;height:20px;box-shadow:var(--shadow-xs);color:var(--white);font-size:10px;font-weight:var(--font-weight-bold);border-radius:20px;justify-content:center;align-items:center;display:flex;position:absolute;top:-2px;right:-4px}.unread-count-hidden.jsx-e1a9288d19b2f001{transform:scale(0)}"})]})}],496712)},268510,955493,993786,963719,e=>{"use strict";var a,t,i=e.i(191788);function s(){return(s=Object.assign.bind()).apply(null,arguments)}let r=e=>i.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},e),a||(a=i.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M15 9.753q-.053.57-.285.999c-.241.447-.844.405-1.203.045L5.21 2.496c-.385-.386-.395-1.022.069-1.308C5.976.76 6.875.5 8 .5c3.331 0 4.679 2.396 4.679 4.502 0 1.417.64 2.05 1.25 2.65C14.476 8.196 15 8.712 15 9.754M3.325 4.798a1.12 1.12 0 0 0-.307-.837l-1.49-1.49a.667.667 0 1 1 .943-.942l11.5 11.5a.667.667 0 1 1-.942.942l-1.288-1.287a1.04 1.04 0 0 0-.831-.293c-.833.078-1.8.109-2.91.109-4.643 0-6.792-.54-7-2.747 0-1.042.523-1.558 1.072-2.1.608-.601 1.25-1.234 1.25-2.651q0-.102.003-.204m3.318 8.816a.75.75 0 1 0-1.286.772c.575.958 1.666 1.364 2.643 1.364s2.068-.406 2.643-1.364a.75.75 0 1 0-1.286-.772c-.225.376-.734.636-1.357.636s-1.132-.26-1.357-.636",clipRule:"evenodd"})));function n(){return(n=Object.assign.bind()).apply(null,arguments)}e.s(["default",0,r],955493),e.s(["BellFilledSlash16Icon",0,r],268510);let o=e=>i.createElement("svg",n({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},e),t||(t=i.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8 .25h-.042c-1.369 0-2.454 0-3.32.088-.888.09-1.629.279-2.277.712A4.8 4.8 0 0 0 1.05 2.361C.617 3.009.428 3.75.338 4.638.25 5.504.25 6.589.25 7.958v.084l.088 3.32c.09.888.279 1.629.712 2.277a4.8 4.8 0 0 0 1.311 1.311c.648.433 1.389.622 2.277.712.866.088 1.951.088 3.32.088h.084l3.32-.088c.888-.09 1.629-.279 2.277-.712a4.8 4.8 0 0 0 1.311-1.311c.433-.648.622-1.389.712-2.277.088-.866.088-1.951.088-3.32v-.084l-.088-3.32c-.09-.888-.279-1.629-.712-2.277a4.8 4.8 0 0 0-1.311-1.311C12.991.617 12.25.428 11.362.338 10.496.25 9.411.25 8.042.25zM3.194 2.298c.361-.241.826-.389 1.595-.467.782-.08 1.79-.08 3.21-.08l3.21.08c.769.078 1.235.226 1.595.467.355.237.66.542.897.897.241.361.389.826.467 1.595.079.782.08 1.79.08 3.21v.403l-.08-.073c-.586-.526-1.401-1.08-2.351-1.08-.676 0-1.165.441-1.478.809-.325.382-.616.873-.864 1.292l-.006.011-.719 1.102c-.196.236-.295.27-.308.274-.168-.001-.368-.054-.63-.168l-.412-.197-.064-.032-.397-.195c-.307-.143-.706-.303-1.142-.312a1.8 1.8 0 0 0-1.335.555c-.551.544-1.2 1.348-1.696 1.993l-.398.525-.072-.103c-.241-.361-.389-.826-.467-1.595-.08-.782-.08-1.79-.08-3.21l.08-3.21c.078-.769.226-1.235.467-1.595a3.3 3.3 0 0 1 .897-.897zm9.974 7.149c.4.359.753.778 1.047 1.14l-.046.623c-.078.769-.226 1.235-.467 1.595a3.3 3.3 0 0 1-.897.897c-.361.241-.826.389-1.595.467-.782.079-1.79.08-3.21.08s-2.429-.001-3.21-.08c-.559-.057-.958-.151-1.273-.291l.439-.581 1.562-1.841c.116-.115.187-.123.25-.122.109.002.272.047.542.172l.348.171.069.035.489.233c.342.149.765.293 1.234.293.674 0 1.155-.455 1.455-.816.306-.368.585-.839.826-1.247l.03-.05.723-1.096a1.2 1.2 0 0 1 .264-.248.3.3 0 0 1 .06-.031l.011-.003c.377 0 .836.236 1.35.697zM4.75 5.5a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0m.75-2.25A2.25 2.25 0 1 0 7.75 5.5v-.001A2.25 2.25 0 0 0 5.501 3.25z"})));e.s(["default",0,o],993786),e.s(["Image16Icon",0,o],963719)},733191,e=>{"use strict";let a;var t,i,s,r=e.i(600498),n=e.i(56989),o=e.i(383294);(t=s||(s={})).MessageImageZ=r.object({url:r.string().url().refine(e=>n.CDN_URLS.some(a=>e.startsWith(a))),width:r.number().positive().transform(e=>Math.floor(e)),height:r.number().positive().transform(e=>Math.floor(e)),mime_type:r.string().refine(e=>n.CDN_SUPPORTED_IMAGE_TYPES.includes(e)),type:r.literal("image").optional()}),t.MessageVideoZ=r.object({url:r.string().url().refine(e=>e.startsWith(o.VIDEO_CDN_URL)),preview_image_url:r.string().url().refine(e=>n.CDN_URLS.some(a=>e.startsWith(a))).optional().nullable(),width:r.number().positive().transform(e=>Math.floor(e)),height:r.number().positive().transform(e=>Math.floor(e)),duration_seconds:r.number().nonnegative().transform(e=>Math.floor(e)),mime_type:r.string().refine(e=>n.CDN_SUPPORTED_VIDEO_TYPES.includes(e)),type:r.literal("video")}),a=r.object({message_api_id:r.string().refine(e=>RegExp("^chatmsg-[0-9a-zA-Z-]{5,20}$").test(e)).brand("chat-message")}),t.SingleMessageInputZ=r.union([r.object({...a.shape,message:r.string()}),r.object({...a.shape,image:t.MessageImageZ}),r.object({...a.shape,media:r.array(t.MessageVideoZ).length(1)})]),(i=t.MessageType||(t.MessageType={})).System="system",i.User="user",e.s(["Chat",()=>s])},923449,e=>{"use strict";e.s(["IS_TYPING_TIMEOUT_MS",()=>y,"SEND_IS_TYPING_EVERY_MS",()=>j,"createUploadableChatImage",()=>S,"createUploadableChatVideo",()=>T,"getConversationName",()=>M,"getConversationTimezone",()=>k,"isChatMessageValid",()=>R,"renderMessageAsText",()=>I,"useChatDraft",()=>L,"useChatImageField",()=>A,"useIsChatMuted",()=>E,"useMarkConversationAsRead",()=>C,"useSendMessages",()=>U,"useStartChatWithUser",()=>P],923449);var a=e.i(538865),t=e.i(398050),i=e.i(191788),s=e.i(821384),r=e.i(426426),n=e.i(988124),o=e.i(167643),l=e.i(99354),d=e.i(82602),c=e.i(93954),u=e.i(86316),h=e.i(56989),p=e.i(655794),m=e.i(277155),f=e.i(733191),g=e.i(829900),v=e.i(32021),x=e.i(348688),b=e.i(465028),_=e.i(47485);let j=1e3,y=2e3,w=(0,m.throttle)(async e=>{let{chat_conversation_api_id:a}=e;try{await x.APIClient.post("/chat/conversation/mark-as-read",{chat_conversation_api_id:a})}catch(e){console.error("Could not mark conversation as read.")}},500,{leading:!1,trailing:!0}),C=e=>{let{conversationsState:a}=(0,_.useChatContext)();return(0,i.useCallback)(async()=>{a.markConversationRead(e),await w({chat_conversation_api_id:e})},[e])},M=e=>{let{info:a,t}=e;return"direct"===a.type?a.other_participant.user.name||t(p.CT.Anonymous):a.conversation.name||t({defaultMessage:"Group Chat",id:"b28RXI",description:"Group chat with no custom name."})},k=e=>{let{info:a}=e;return"direct"===a.type&&a.other_participant.user.timezone||null},T=async e=>{let a=URL.createObjectURL(e),t=await (0,l.getVideoDimensions)({url:a});return{remoteUrlPromise:(0,c.uploadFileToS3)({file:e,destination:{bucket:"video-cdn.lu.ma",folder:"user-uploads"},type:"video",createPresignedUrl:b.createPresignedUrl}).then(e=>{let{file_url:a}=e;return a}).finally(()=>{URL.revokeObjectURL(a)}),url:a,file:e,type:"video",mime_type:e.type,...t}},S=async e=>{let a=URL.createObjectURL(e),t=await (0,l.getImageDimensions)({url:a});return{remoteUrlPromise:(0,c.uploadFileToS3)({file:e,destination:{bucket:"images.lumacdn.com",folder:"chat"},type:"image",createPresignedUrl:b.createPresignedUrl}).then(e=>{let{file_url:a}=e;return a}).finally(()=>{URL.revokeObjectURL(a)}),url:a,file:e,type:"image",mime_type:e.type,...t}},N={url:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",mime_type:"image/gif",width:1,height:1,type:"image"},A=()=>{let{setValues:e}=(0,a.useFormikContext)(),{featureFlags:t}=(0,g.useUserContext)();return{upload:async a=>{if(0===a.length)return;let i=(e=>{let{files:a,supportedTypes:t}=e;for(let e=0;e<a.length;e+=1){let i=a[e];if(t.includes(i.type))return i}return null})({files:a,supportedTypes:t.chatVideoMessages?[...h.CDN_SUPPORTED_IMAGE_TYPES,...h.CDN_SUPPORTED_VIDEO_TYPES]:h.CDN_SUPPORTED_IMAGE_TYPES});if(!i)return void(0,d.toastError)("You can only send JPG, GIF, PNG and WebP images.");let s=i.type.startsWith("video/")?"video":"image";e(e=>({...e,media:{...N,remoteUrlPromise:null,file:i}}));try{let a="video"===s?await T(i):await S(i);e(e=>{var t;return(null==(t=e.media)?void 0:t.file)!==i?e:{...e,media:a}});let t=await a.remoteUrlPromise;e(e=>{var a;return(null==(a=e.media)?void 0:a.file)===i&&t?{...e,media:{...e.media,url:t}}:e})}catch(a){console.error(a),(0,d.toastError)("Uploading chat image failed, please try again."),e(e=>{var a;return(null==(a=e.media)?void 0:a.file)!==i?e:{...e,media:null}})}}}},I=e=>{var a,t,i,s;let{message:r,t:n}=e;return(null==(t=r.media)||null==(a=t[0])?void 0:a.type)==="video"?n({defaultMessage:"Video",id:"H4LoGt",description:"Chats list. Last message preview label."}):r.image||(null==(s=r.media)||null==(i=s[0])?void 0:i.type)==="image"?n({defaultMessage:"Image",id:"4wgM0v",description:"Chats list. Last message preview label."}):r.message||null};function P(){let e=(0,u.useT)(),{conversationsState:a,openConversation:t}=(0,_.useChatContext)();return async i=>{let s=a.conversations.find(e=>{var a;return"direct"===e.type&&(null==(a=e.other_participant)?void 0:a.user_api_id)===i.api_id});s?t(s.conversation.api_id):await (0,n.callWithToast)(async()=>{let e=await x.APIClient.post("/chat/conversation/create",{type:"direct",to_user_api_id:i.api_id});a.addConversation(e),t(e.conversation.api_id)},{error:e({defaultMessage:"Failed to create conversation.",id:"Ymqe/h",description:"Chat button. Error toast."})})}}let O=s.z.object({message:s.z.string()});function L(e){let a=(0,v.useUserLocalStorage)(),t="chat.".concat(e,".message-composer"),s=(0,i.useMemo)(()=>null==a?void 0:a.get({key:t,schema:O}),[a,t]),r=(0,i.useCallback)(e=>{null==a||a.save({key:t,schema:O,value:e})},[a,t]);return{message:null==s?void 0:s.message,update:r}}function E(e){let{info:a}=e,i=(0,r.useNow)();return!!(a.mute_until&&t.DateTime.fromISO(a.mute_until)>i)}let R=e=>{let{message:a,media:t}=e;return!!(t?null==t?void 0:t.remoteUrlPromise:a.trim())},U=()=>{let{user:e}=(0,g.useUserContext)(),{messages:{onMessages:a},openConversationApiId:s}=(0,_.useChatContext)();return(0,i.useCallback)(async i=>{let{replying_to_message_api_id:r,messages:n}=i;if(!e||!s)return;let l={user_api_id:e.api_id,last_read_chat_message_sent_at:null,chat_conversation_api_id:s,removed_at:null,role:null,user:{api_id:e.api_id,avatar_url:e.avatar_url,bio_short:e.bio_short,instagram_handle:e.instagram_handle,is_verified:e.is_verified,last_online_at:t.DateTime.now().toISO(),linkedin_handle:e.linkedin_handle,name:e.name,tiktok_handle:e.tiktok_handle,timezone:e.timezone,twitter_handle:e.twitter_handle,username:e.username,website:e.website,youtube_handle:e.youtube_handle}},d=t.DateTime.now().toUTC().toISO(),c=n.map((a,t)=>({...a,chat_conversation_api_id:s,chat_participant_api_id:"",deleted_at:null,replying_to_message_api_id:0===t?r:null,user_api_id:e.api_id,metadata:[],sent_at:d,cursor:"".concat(d,"_").concat(a.api_id),message_type:f.Chat.MessageType.User,context:{},author:l,num_hearts:0,reactions:[]}));a(c);try{let e=await Promise.all(c.map(e=>{var a,t,i,s;return null!=(s=null==(a=e.image)?void 0:a.remoteUrlPromise)?s:null==(i=e.media)||null==(t=i[0])?void 0:t.remoteUrlPromise})),a={chat_conversation_api_id:s,replying_to_message_api_id:r,batch:n.map((a,t)=>{let{api_id:i,...s}=a;return s.image?{message_api_id:i,image:{height:s.image.height,width:s.image.width,mime_type:s.image.mime_type,url:e[t]||s.image.url}}:s.media?{message_api_id:i,media:[{type:s.media[0].type,height:s.media[0].height,width:s.media[0].width,mime_type:s.media[0].mime_type,url:e[t]||s.media[0].url,duration_seconds:s.media[0].duration_seconds}]}:{message:s.message,message_api_id:i}})};try{await x.APIClient.post("/chat/conversation/send",a)}catch(e){if((0,o.isNetworkError)(e))await x.APIClient.post("/chat/conversation/send",a);else throw e}}catch(e){throw a(c.map(e=>({...e,error:!0}))),e}},[e,s,a])}},406764,906002,e=>{"use strict";e.s(["ChatLoadingState",()=>g],406764);var a=e.i(391398);e.s(["ConversationRow",()=>p,"ConversationRowShimmer",()=>f],906002);var t=e.i(359626),i=e.i(272043),s=e.i(206046),r=e.i(268510),n=e.i(963719),o=e.i(852491),l=e.i(86316),d=e.i(608337),c=e.i(402818),u=e.i(47485),h=e.i(923449);let p=e=>{var s,n;let{info:o}=e,p=(0,l.useT)(),{conversation:f}=o,{openConversation:g,conversationsState:v}=(0,u.useChatContext)(),x=v.unreadConversations.has(o.conversation.api_id),b=(0,h.useIsChatMuted)({info:o});return(0,a.jsxs)("button",{type:"button",onClick:()=>g(f.api_id),className:"jsx-3225eefa365671dc "+((0,i.default)("btn conversation flex-center",x&&"conversation-unread")||""),children:[(0,a.jsx)(c.ChatConversationAvatar,{info:o,px:40}),(0,a.jsxs)("div",{className:"jsx-3225eefa365671dc conversation-body flex-start flex-column flex-1",children:[(0,a.jsx)("div",{className:"jsx-3225eefa365671dc participant fw-medium text-ellipses",children:(0,h.getConversationName)({info:o,t:p})}),o.last_message&&(0,a.jsxs)("div",{className:"jsx-3225eefa365671dc last-message",children:[(0,a.jsx)("span",{className:"jsx-3225eefa365671dc last-message-text",children:o.last_message.deleted_at?p({defaultMessage:"Message Deleted",id:"VGdHqa",description:"Chat. Deleted message placeholder."}):(0,a.jsxs)(a.Fragment,{children:[(null!=(n=null==(s=o.last_message.media)?void 0:s.length)&&n||o.last_message.image)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m,{className:"inline",message:o.last_message})," "]}),(0,h.renderMessageAsText)({message:o.last_message,t:p})]})}),(0,a.jsxs)("span",{className:"jsx-3225eefa365671dc text-tertiary-alpha",children:[" · ",(0,a.jsx)(d.ShortDuration,{className:"nowrap",time:o.last_message.sent_at})]})]})]}),(0,a.jsxs)("div",{className:"jsx-3225eefa365671dc right-element-container",children:[(0,a.jsx)("div",{className:"jsx-3225eefa365671dc "+((0,i.default)("unread-indicator-container flex-center-center animated",b&&"opacity-0")||""),children:(0,a.jsx)("div",{className:"jsx-3225eefa365671dc unread-indicator animated"})}),(0,a.jsx)(r.BellFilledSlash16Icon,{className:(0,i.default)("bell-icon svg-xs animated",{"text-tertiary-alpha":b,"opacity-0":!b})})]}),(0,a.jsx)(t.default,{id:"3225eefa365671dc",children:".conversation.jsx-3225eefa365671dc{z-index:1;border-radius:0;gap:.6875rem;width:100%;padding:.5rem .75rem .5rem 1rem;position:relative}.conversation.jsx-3225eefa365671dc:hover{background-color:var(--opacity-second-light)}.conversation-body.jsx-3225eefa365671dc{overflow:hidden}.participant.jsx-3225eefa365671dc{color:var(--primary-color);text-align:left;max-width:100%}.last-message.jsx-3225eefa365671dc{font-size:var(--font-size-sm);font-weight:var(--font-weight-regular);text-align:left;max-width:100%;display:flex}.last-message.jsx-3225eefa365671dc svg{width:var(--font-size-sm);height:var(--font-size-sm);position:relative;top:-1px}.last-message-text.jsx-3225eefa365671dc{color:var(--secondary-color-alpha);white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.conversation-unread.jsx-3225eefa365671dc .last-message-text.jsx-3225eefa365671dc{color:var(--brand-color);font-weight:var(--font-weight-bold)}.right-element-container.jsx-3225eefa365671dc{align-self:center;position:relative}.text-transparent.jsx-3225eefa365671dc{color:transparent}.unread-indicator-container.jsx-3225eefa365671dc{position:absolute;top:0;bottom:0;left:0;right:0}.unread-indicator.jsx-3225eefa365671dc{background:var(--unread-badge-bg-color,var(--error-color));opacity:0;transform-origin:50%;border-radius:.5rem;width:.5rem;height:.5rem;transform:scale(0)}.conversation-unread.jsx-3225eefa365671dc .unread-indicator.jsx-3225eefa365671dc{opacity:1;transform:scale(1)}"})]})},m=e=>{var t,i;let{message:s,className:r}=e;return(null==(i=s.media)||null==(t=i[0])?void 0:t.type)==="video"?(0,a.jsx)(o.Video16Icon,{className:r}):s.image?(0,a.jsx)(n.Image16Icon,{className:r}):null},f=()=>(0,a.jsxs)("div",{className:"py-2 px-3 flex-center",style:{gap:"0.6875rem"},children:[(0,a.jsx)("div",{children:(0,a.jsx)(s.Shimmer,{width:40,height:40,shape:"circle"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(s.TextShimmer,{width:"8rem"}),(0,a.jsx)(s.TextShimmer,{width:"12rem",size:"sm"})]})]}),g=()=>(0,a.jsx)("div",{className:"chat-loading",children:[1,2,3,4,5,6,7,8].map(e=>(0,a.jsx)(f,{},e))})},608239,493502,e=>{"use strict";e.s(["ChatsWindow",()=>c],608239);var a=e.i(391398),t=e.i(359626),i=e.i(95267),s=e.i(424017),r=e.i(97497),n=e.i(86316),o=e.i(406764),l=e.i(47485),d=e.i(906002);let c=e=>{let{onClose:o}=e,l=(0,n.useT)();return(0,a.jsxs)("div",{className:"jsx-f6264e660eec8e6e chats-window flex-column flex-1",children:[(0,a.jsxs)("div",{className:"jsx-f6264e660eec8e6e chats-header flex-center spread p-25 pl-3",children:[(0,a.jsxs)("div",{className:"jsx-f6264e660eec8e6e flex-center",children:[(0,a.jsx)("div",{className:"jsx-f6264e660eec8e6e fw-bold fs-lg",children:l({defaultMessage:"Chats",id:"6Ip4bV",description:"Chats window title."})}),(0,a.jsx)(s.LuxButton,{href:"/chat",openInNewTab:!0,variant:"link",color:"secondary",iconPlacement:"icon-only",size:"large",className:"px-1",icon:(0,a.jsx)(r.default,{}),label:l({defaultMessage:"Open Fullscreen Chat",id:"NC+WMf",description:"Button label to open the chat in a new tab."})})]}),(0,a.jsx)(i.CloseButton,{variant:"naked",rounded:!0,onClick:o})]}),(0,a.jsx)(u,{}),(0,a.jsx)(t.default,{id:"f6264e660eec8e6e",children:".chats-window.jsx-f6264e660eec8e6e{max-height:100%;padding-bottom:env(safe-area-inset-bottom)}.chats-header.jsx-f6264e660eec8e6e{background-color:var(--bg-opacity-24);border-bottom:1px solid var(--divider-color)}"})]})},u=()=>{let{conversationsState:e}=(0,l.useChatContext)(),{conversations:i,loading:s}=e;return i&&i.length>0?(0,a.jsxs)("div",{className:"jsx-4c7ce14ce9c37564 conversations flex-column flex-1",children:[null==i?void 0:i.map(e=>(0,a.jsx)(d.ConversationRow,{info:e},e.conversation.api_id)),(0,a.jsx)(t.default,{id:"4c7ce14ce9c37564",children:".conversations.jsx-4c7ce14ce9c37564{padding-bottom:calc(4rem + 1px);overflow-y:auto}"})]}):s?(0,a.jsx)(o.ChatLoadingState,{}):null};var h=e.i(191788);e.s(["useWindowFocus",0,()=>{let[e,a]=(0,h.useState)(!1);return(0,h.useEffect)(()=>{a(document.hasFocus());let e=()=>a(!0),t=()=>a(!1);return window.addEventListener("focus",e),window.addEventListener("blur",t),()=>{window.removeEventListener("focus",e),window.removeEventListener("blur",t)}},[]),e}],493502)},112544,355927,e=>{"use strict";e.s(["ChatMessageComposer",()=>C],112544);var a=e.i(391398),t=e.i(359626),i=e.i(538865),s=e.i(191788),r=e.i(424017),n=e.i(522476),o=e.i(374426),l=e.i(254662),d=e.i(694832),c=e.i(993786),u=e.i(717745),h=e.i(469891),p=e.i(88315),m=e.i(922323),f=e.i(86316),g=e.i(56989),v=e.i(655794),x=e.i(277155),b=e.i(277386),_=e.i(829900),j=e.i(839746),y=e.i(47485),w=e.i(923449);let C=s.default.forwardRef((e,o)=>{let{disabled:d,onChange:h,maxRows:p=3}=e,m=(0,f.useT)(),g=(0,l.useIsMobileBrowser)(),{user:v}=(0,_.useUserContext)(),{openConversationApiId:C,replyingToMessage:T,setReplyingToMessage:S}=(0,y.useChatContext)(),N=(0,s.useRef)(null);(0,s.useImperativeHandle)(o,()=>N.current),(0,s.useEffect)(()=>{var e;null==(e=N.current)||e.focus()},[T]);let A=(0,s.useRef)(null),{submitForm:I,values:P}=(0,i.useFormikContext)(),{upload:O}=(0,w.useChatImageField)();(0,s.useEffect)(()=>{h({message:P.message})},[P.message,h]);let L=d||!(0,w.isChatMessageValid)(P),E=(0,j.useCentrifugeSubscription)({channel:C?(0,b.getRealTimeChannelForChatConversation)({chat_conversation_api_id:C}):void 0}),R=(0,s.useMemo)(()=>(null==v?void 0:v.api_id)&&E&&C?(0,x.throttle)(()=>{let e={type:b.RealTimeUpdateType.ChatParticipantIsTyping,user_api_id:v.api_id,chat_conversation_api_id:C};E.publish(e)},w.SEND_IS_TYPING_EVERY_MS,{leading:!0,trailing:!1}):null,[E,C,null==v?void 0:v.api_id]);return(0,a.jsxs)("div",{className:"jsx-64af9f64c51f8d21",children:[T&&(0,a.jsx)(k,{message:T,onRemove:()=>{S(null)}}),(0,a.jsxs)("div",{className:"jsx-64af9f64c51f8d21 chat-footer",children:[(0,a.jsx)("input",{type:"file",ref:A,onChange:e=>{e.preventDefault(),O(e.target.files),e.target.value=""},style:{display:"none"},className:"jsx-64af9f64c51f8d21"}),(0,a.jsx)(r.LuxButton,{iconPlacement:"icon-only",icon:(0,a.jsx)(c.default,{}),rounded:!0,className:"mr-2",label:m({defaultMessage:"Add Image",id:"QtAKcC",description:"Chat. Button CTA."}),color:"light",onClick:e=>{var a;e.preventDefault(),null==(a=A.current)||a.click()}}),(0,a.jsxs)("div",{className:"jsx-64af9f64c51f8d21 chat-composer",children:[(0,a.jsx)(M,{}),(0,a.jsx)(n.LuxTextareaField,{ref:N,autoFocus:!g,moveCursorToEndOnAutoFocus:!0,maxRows:p,name:"message",className:"flex-1",placeholder:m({defaultMessage:"Send a message",id:"nuLyTJ",description:"Chat. Input placeholder."}),rounded:!0,onKeyDown:e=>{null==R||R(),"Enter"!==e.key||e.shiftKey||e.nativeEvent.isComposing||(e.preventDefault(),I())},onPaste:async e=>{let a=e.clipboardData.files;a.length>0&&(e.preventDefault(),O(a))}})]}),(0,a.jsx)(r.LuxButton,{iconPlacement:"icon-only",icon:(0,a.jsx)(u.default,{}),rounded:!0,className:"chat-send-button ml-2",label:m({defaultMessage:"Send",id:"iPRVy8",description:"Chat. Button CTA."}),color:"light",onClick:()=>I(),disabled:L})]}),(0,a.jsx)(t.default,{id:"64af9f64c51f8d21",children:".chat-footer.jsx-64af9f64c51f8d21>.chat-send-button svg{position:relative;top:1px;left:-1.5px}.chat-footer.jsx-64af9f64c51f8d21{flex-direction:row;align-items:flex-end;padding:.625rem .75rem .875rem;display:flex}.chat-composer.jsx-64af9f64c51f8d21{flex:1}.chat-footer.jsx-64af9f64c51f8d21 .lux-input{--placeholder-color:var(--input-disabled-color);background:var(--light-button-bg-color)!important;border:1px solid transparent!important}.chat-footer.jsx-64af9f64c51f8d21 .invalid-feedback{display:none}"})]})}),M=()=>{let e=(0,f.useT)(),{values:s,setValues:n}=(0,i.useFormikContext)(),{media:l}=s;return l?(0,a.jsxs)("div",{className:"jsx-9fef0493a73b2c07 media-preview-wrapper my-1",children:[(0,a.jsxs)("div",{className:"jsx-9fef0493a73b2c07 media-preview",children:["video"===l.type?(0,a.jsx)("video",{src:l.url,width:52,height:52,className:"jsx-9fef0493a73b2c07 media-preview-content"}):(0,a.jsx)("img",{src:(0,g.getImageUrl)({url:l.url,width:52,height:52}),width:52,height:52,className:"jsx-9fef0493a73b2c07 media-preview-content"}),l.url.startsWith("blob")&&(0,a.jsx)("div",{className:"jsx-9fef0493a73b2c07 media-preview-overlay",children:(0,a.jsx)(o.Spinner,{})}),(0,a.jsx)(r.LuxButton,{className:"media-preview-remove",icon:(0,a.jsx)(h.default,{}),onClick:()=>{n(e=>{var a;return(null==(a=e.media)?void 0:a.file)!==l.file?e:{...e,media:null}})},label:e("video"===l.type?{defaultMessage:"Remove Video",id:"tBFOca",description:"Chat. Button CTA."}:{defaultMessage:"Remove Image",id:"2znWoM",description:"Chat. Button CTA."}),iconPlacement:"icon-only",size:"small",rounded:!0,color:"primary"})]}),(0,a.jsx)(t.default,{id:"9fef0493a73b2c07",children:".media-preview-wrapper.jsx-9fef0493a73b2c07{flex-direction:row;margin:0 .5rem;display:flex}.media-preview.jsx-9fef0493a73b2c07{border:var(--input-border);display:flex;position:relative}.media-preview.jsx-9fef0493a73b2c07,.media-preview-content.jsx-9fef0493a73b2c07,.media-preview-overlay.jsx-9fef0493a73b2c07{border-radius:var(--border-radius)}.media-preview-content.jsx-9fef0493a73b2c07{object-fit:cover}.media-preview-overlay.jsx-9fef0493a73b2c07{background:var(--disabled-bg-color-translucent);justify-content:center;align-items:center;display:flex;position:absolute;top:0;bottom:0;left:0;right:0}.media-preview-wrapper.jsx-9fef0493a73b2c07 .media-preview-remove{top:calc(-1*var(--small-input-height)/3);right:calc(-1*var(--small-input-height)/3);position:absolute!important}"})]}):null},k=e=>{var t,i;let{message:s,onRemove:n}=e,{user:o}=(0,_.useUserContext)(),l=(0,f.useT)(),c=s.user_api_id===(null==o?void 0:o.api_id);return(0,a.jsxs)("div",{className:"flex-center reply-to border-top pt-2 px-2 gap-2",children:[(0,a.jsx)("div",{className:"p-1 pl-2 text-tertiary-alpha",children:(0,a.jsx)(d.default,{})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"fs-xs text-tertiary-alpha",children:c?(0,a.jsx)(m.T,{defaultMessage:"Reply to yourself",id:"4YaM2N",description:"Chat. Title on the chat composer when the composed message will be sent as a response to another message that the current user has written."}):(0,a.jsx)(m.T,{defaultMessage:"Reply to {author_name}",id:"oA3wTU",description:"Chat. Title on the chat composer when the composed message will be sent as a response to a message from another user.",values:{author_name:null!=(i=null==(t=s.author)?void 0:t.user.name)?i:l(v.CT.Anonymous)}})}),(0,a.jsx)("div",{className:"fs-sm text-ellipses",children:(0,w.renderMessageAsText)({message:s,t:l})||(0,a.jsx)("span",{className:"text-tertiary-alpha",children:(0,a.jsx)(m.T,{defaultMessage:"Empty message.",id:"K9xXiS"})})})]}),s.image&&(0,a.jsx)("img",{src:(0,g.getImageUrl)({url:s.image.url,width:36,height:36}),width:36,height:36,className:"rounded mx-1"}),s.media&&(0,a.jsx)("video",{src:s.media[0].url,width:36,height:36,className:"rounded mx-1"}),(0,a.jsx)(r.LuxButton,{icon:(0,a.jsx)(p.default,{}),className:"m-1",onClick:()=>{n()},label:l(v.CT.Dismiss),iconPlacement:"icon-only-compact",rounded:!0,variant:"link",color:"secondary"})]})};e.s(["ChatMessageDropzone",()=>A],355927);var T=e.i(217190),S=e.i(437714),N=e.i(350885),N=N;let A=e=>{let{children:i}=e,r=(0,f.useT)(),{isDragging:n}=(()=>{let[e,a]=(0,s.useState)(!1),t=(0,s.useRef)(void 0);return(0,s.useEffect)(()=>{let e=e=>{var t;(null==(t=e.dataTransfer)?void 0:t.types.includes("Files"))&&a(!0)},i=()=>{window.clearTimeout(t.current)},s=()=>{t.current=window.setTimeout(()=>{a(!1)},20)},r=()=>{window.clearTimeout(t.current),a(!1)};return window.addEventListener("dragenter",e),window.addEventListener("dragover",i),window.addEventListener("dragleave",s),window.addEventListener("drop",r),window.addEventListener("dragend",r),()=>{window.removeEventListener("dragenter",e),window.removeEventListener("dragover",i),window.removeEventListener("dragleave",s),window.removeEventListener("drop",r),window.removeEventListener("dragend",r),window.clearTimeout(t.current)}},[]),{isDragging:e}})(),{upload:o}=(0,w.useChatImageField)(),{getRootProps:l,getInputProps:d,isDragActive:c}=(0,T.useDropzone)({accept:S.ACCEPT_IMAGE_PROP,noClick:!0,multiple:!1,onDrop(e,a){o([...e,...a.map(e=>e.file)])},noKeyboard:!0}),u=r({defaultMessage:"Drag image here to upload it.",id:"q944Vx",description:"Chat. Drop zone label."});return c&&(u=r({defaultMessage:"Drop your image to start uploading it.",id:"BkvfGT",description:"Chat. Drop zone label when active."})),(0,a.jsxs)(a.Fragment,{children:[n?(0,a.jsx)("div",{className:"jsx-5f132b8b754bb075 chat-dropzone-wrapper flex-column flex-center-center p-3",children:(0,a.jsx)(S.DropZone,{icon:(0,a.jsx)(N.default,{}),className:"flex-1",label:r({defaultMessage:"Send Image",id:"e4mifx",description:"Chat. Drop zone title."}),sublabel:u,isDragActive:c,rootProps:l(),inputProps:d()})}):i,(0,a.jsx)(t.default,{id:"5f132b8b754bb075",children:".chat-dropzone-wrapper.jsx-5f132b8b754bb075{width:100%;height:100%}"})]})}},615044,e=>{"use strict";var a=e.i(391398),t=e.i(359626),i=e.i(272043),s=e.i(88719),r=e.i(374426),n=e.i(826420),o=e.i(56989),l=e.i(562672);e.s(["ChatMessageMedia",0,e=>{let{media:d}=e,c=(0,n.useBoolean)(),{size:u,aspectRatio:h}=(e=>{let{width:a,height:t}=e,i=a/t;return i>1?{aspectRatio:i,size:{width:199,height:199/i}}:{aspectRatio:i,size:{height:199,width:199*i}}})(d),p=(0,l.clamp)(h,.5,2),m={position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"},f="video"===d.type?!d.preview_image_url:!c.value||d.url.startsWith("blob");return(0,a.jsxs)("div",{style:{maxWidth:u.width,height:u.width/p,width:d.width},className:"jsx-6ce31c75de618731 chat-media-wrapper",children:["video"===d.type?(0,a.jsx)("video",{muted:!0,preload:"none",poster:d.preview_image_url?(0,o.getImageUrl)({url:d.preview_image_url,width:u.width,height:u.width/p}):void 0,playsInline:!0,controls:!f,style:m,src:d.url,className:"jsx-6ce31c75de618731"}):(0,a.jsx)(s.ImgWithLightbox,{allowAnimation:!0,src:{small:(0,o.getImageUrl)({url:d.url,width:u.width,height:u.width/p,allowAnimation:!0}),large:d.url},aspect_ratio:p,style:m,onLoad:c.setTrue}),f&&(0,a.jsx)("div",{className:"jsx-6ce31c75de618731 "+((0,i.default)("media-placeholder",{video:"video"===d.type})||""),children:(0,a.jsx)(r.Spinner,{})}),(0,a.jsx)(t.default,{id:"6ce31c75de618731",children:".chat-media-wrapper.jsx-6ce31c75de618731{max-width:100%;min-height:calc(4*var(--chat-message-bubble-border-radius));min-width:calc(4*var(--chat-message-bubble-border-radius));border-radius:var(--chat-message-bubble-border-radius);background:var(--chat-message-media-background);position:relative;overflow:hidden}.media-placeholder.jsx-6ce31c75de618731{background-color:var(--bg-opacity-32);justify-content:center;align-items:center;width:100%;height:100%;display:flex;position:absolute;top:0;left:0}.media-placeholder.video.jsx-6ce31c75de618731{background-color:var(--secondary-bg-color)}"})]})}])},915626,41118,346608,657164,e=>{"use strict";e.s(["ChatMessage",()=>et],915626);var a,t,i,s=e.i(391398),r=e.i(359626),n=e.i(272043),o=e.i(620317),l=e.i(191788),d=e.i(566119),c=e.i(826420),u=e.i(86316),h=e.i(145897),p=e.i(655794),m=e.i(829900),f=e.i(581254),g=e.i(615044);e.s(["ChatTextBubble",()=>M,"ChatTextBubbleShimmer",()=>k],41118);var v=e.i(398050),x=e.i(842828),b=e.i(206046),_=e.i(295787),j=e.i(851800),y=e.i(306610),w=e.i(47485);let C=/^(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff]){1,3}$/,M=e=>{let{message:a,type:t,isReply:i}=e,{closeChatWindow:o}=(0,w.useChatContext)(),d=C.test(a.message),c=(0,_.useIsMounted)(),u=(0,j.useLocale)(),h=(0,l.useCallback)(()=>{(window.innerWidth<=y.CHAT_WINDOW_FULL_SCREEN_DIMENSIONS.width||window.innerHeight<=y.CHAT_WINDOW_FULL_SCREEN_DIMENSIONS.height)&&o()},[o]);return(0,s.jsxs)("div",{title:c?v.DateTime.fromISO(a.sent_at).setLocale(u).toLocaleString(v.DateTime.DATETIME_FULL):void 0,className:"jsx-5ae48763946b123 "+((0,n.default)("chat-message-bubble",{"chat-message-bubble-current":"current-user"===t,"chat-message-bubble-system":"system"===t,"chat-message-bubble-other":"other-user"===t,"chat-message-bubble-emoji":d,reply:i})||""),children:[(0,s.jsx)(x.LinkedText,{text:a.message,onClick:h,className:"inner"}),(0,s.jsx)(r.default,{id:"5ae48763946b123",children:".chat-message-bubble.jsx-5ae48763946b123{min-width:0;padding:var(--chat-message-bubble-padding-vertical)var(--chat-message-bubble-padding-horizontal);border-radius:var(--chat-message-bubble-border-radius);white-space:pre-line;word-break:break-word;line-height:var(--chat-message-bubble-line-height);position:relative}.chat-message-bubble.jsx-5ae48763946b123 a{color:inherit;text-decoration:underline}.chat-message-bubble-current.jsx-5ae48763946b123{background:var(--chat-message-bubble-me-bg-color);color:var(--chat-message-bubble-me-color)}.chat-message-bubble-system.jsx-5ae48763946b123{color:var(--tertiary-color-alpha);font-size:var(--font-size-sm);text-align:center;text-wrap:pretty}.chat-message-bubble-other.jsx-5ae48763946b123{background:var(--chat-message-bubble-other-bg-color);color:var(--chat-message-bubble-other-color)}.chat-message-bubble-emoji.jsx-5ae48763946b123{font-size:var(--chat-message-bubble-emoji-font-size);line-height:var(--chat-message-bubble-emoji-line-height);letter-spacing:var(--chat-message-bubble-emoji-letter-spacing);background:0 0;padding:0}.reply.jsx-5ae48763946b123 .inner{line-clamp:3;-webkit-line-clamp:3;-webkit-box-orient:vertical;display:-webkit-box;overflow:hidden}.reply.jsx-5ae48763946b123{font-size:var(--font-size-sm);background:0 0}.reply.chat-message-bubble-other.jsx-5ae48763946b123{border:1px solid var(--divider-color);color:var(--tertiary-color-alpha)}.reply.chat-message-bubble-current.jsx-5ae48763946b123{border:1px solid var(--faint-chat-blue);color:var(--pale-chat-blue)}"})]})},k=()=>(0,s.jsxs)("div",{className:"jsx-88c98ac5229fe31 chat-message-bubble",children:[(0,s.jsx)(b.TextShimmer,{width:"8rem"}),(0,s.jsx)(r.default,{id:"88c98ac5229fe31",children:".chat-message-bubble.jsx-88c98ac5229fe31{max-width:100%;padding:var(--chat-message-bubble-padding-vertical)var(--chat-message-bubble-padding-horizontal);border-radius:var(--chat-message-bubble-border-radius);line-height:var(--chat-message-bubble-line-height);background:var(--chat-message-bubble-other-bg-color);color:var(--chat-message-bubble-other-color);position:relative}"})]}),T=e=>{var a;let{message:t,sender:i,isReply:n}=e;return(0,s.jsxs)(s.Fragment,{children:[t.image&&(0,s.jsx)("div",{className:"jsx-ab23fc9607a8db32 chat-message-media-wrapper",children:(0,s.jsx)(g.ChatMessageMedia,{media:t.image})}),null==(a=t.media)?void 0:a.map(e=>(0,s.jsx)("div",{className:"jsx-ab23fc9607a8db32 chat-message-media-wrapper",children:(0,s.jsx)(g.ChatMessageMedia,{media:e})},e.url)),"string"==typeof t.message&&(0,s.jsx)(M,{message:t,type:i,isReply:n}),(0,s.jsx)(r.default,{id:"ab23fc9607a8db32",children:".chat-message-media-wrapper.jsx-ab23fc9607a8db32{margin-bottom:var(--chat-message-margin-bottom-same-author)}.chat-message-media-wrapper.jsx-ab23fc9607a8db32:first-child{margin-top:0}"})]})};var S=e.i(842044),N=e.i(684412),A=e.i(424017),I=e.i(801560),P=e.i(106946),O=e.i(988124),L=e.i(694832);function E(){return(E=Object.assign.bind()).apply(null,arguments)}let R=e=>l.createElement("svg",E({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16"},e),a||(a=l.createElement("path",{fillRule:"evenodd",d:"M14.5 8a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M6 7.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2m4.772 3.148c.249-.601-.3-1.148-.95-1.148H6.178c-.65 0-1.199.547-.95 1.148a3 3 0 0 0 5.544 0M11 6.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0",clipRule:"evenodd"})));e.s(["default",0,R],346608);var U=e.i(554542),z=e.i(348688);let D=["❤️","👍","👎","🔥","🤣","😮"],F=e=>{let{message:a,hovered:t}=e,{user:i}=(0,m.useUserContext)(),o=(0,c.useBoolean)(),l=(0,c.useBoolean)(),d=(0,P.useModalState)(),h=(0,u.useT)(),{messages:{onDeleteMessage:p}}=(0,w.useChatContext)(),f=!a.error,g=!a.error&&a.user_api_id===(null==i?void 0:i.api_id),v=o.value||t||l.value;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"jsx-a5da4eb37f77257d "+((0,n.default)("flex-center animated",{"visibility-hidden":!g,"opacity-0":!v})||""),children:(0,s.jsx)(S.ActionMenuButton,{placement:"bottom-start",rounded:!0,color:"secondary",aboveChatWindow:!0,options:[{name:h({defaultMessage:"Delete Message",id:"lIOZuT",description:"Chat. Button CTA."}),key:"delete",icon:(0,s.jsx)(U.default,{}),onClick:d.onShow}]})}),(0,s.jsx)("div",{className:"jsx-a5da4eb37f77257d "+((0,n.default)("flex-center animated",{"visibility-hidden":!f,"opacity-0":!v})||""),children:(0,s.jsx)(B,{message:a})}),(0,s.jsx)("div",{className:"jsx-a5da4eb37f77257d "+((0,n.default)("flex-center animated",{"visibility-hidden":!f,"opacity-0":!v})||""),children:(0,s.jsx)(W,{message:a,open:l.value,setOpen:l.setValue})}),(0,s.jsx)(N.DeleteConfirmationModal,{...d,text:h({defaultMessage:"This message will be deleted for all conversation participants.",id:"WhYErh",description:"Chat. Delete message modal text."}),title:h({defaultMessage:"Delete this Message",id:"+LujNs",description:"Chat. Delete message modal title."}),onConfirm:async()=>{await (0,O.callWithToast)(async()=>{await z.APIClient.post("/chat/message/delete",{chat_message_api_id:a.api_id}),d.onHide(),setTimeout(()=>p(a.api_id),50)},{error:h({defaultMessage:"There was a problem deleting this message.",id:"QfTC+G",description:"Chat. Delete message modal error toast.."})})}}),(0,s.jsx)(r.default,{id:"a5da4eb37f77257d",children:".visibility-hidden.jsx-a5da4eb37f77257d{visibility:hidden}"})]})},B=e=>{let{message:a}=e,t=(0,u.useT)(),{setReplyingToMessage:i}=(0,w.useChatContext)();return(0,s.jsx)(A.LuxButton,{icon:(0,s.jsx)(L.default,{}),label:t({defaultMessage:"Reply",id:"9HU8vw"}),variant:"naked",size:"small",iconPlacement:"icon-only-compact",rounded:!0,color:"secondary",onClick:()=>i(a)})},W=e=>{let{message:a,open:t,setOpen:i}=e,o=(0,u.useT)(),{user:l}=(0,m.useUserContext)(),d=new Set(a.reactions.filter(e=>!e.removed_at).flatMap(e=>e.user_api_id===(null==l?void 0:l.api_id)?e.reaction_type:[]));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(I.LuxBaseMenu,{aboveChatWindow:!0,trigger:(0,s.jsx)("div",{className:"jsx-e261cb7113a9524d",children:(0,s.jsx)(A.LuxButton,{icon:(0,s.jsx)(R,{}),label:o({defaultMessage:"React",id:"rq7RsF",description:"Chat. React button label, allows adding emojis-reactions to a message."}),variant:"naked",size:"small",iconPlacement:"icon-only-compact",color:"secondary",rounded:!0,className:(0,n.default)("react-button",{selected:t}),hideTooltipForIconOnly:t})}),placement:"top",menuBorderRadius:"1000px",open:t,setOpen:i,children:(0,s.jsx)("div",{className:"jsx-e261cb7113a9524d flex p-1 reactions",children:D.map(e=>(0,s.jsx)(V,{message:a,reaction:e,selected:d.has(e),onHide:()=>i(!1)},e))})}),(0,s.jsx)(r.default,{id:"e261cb7113a9524d",children:".reactions.jsx-e261cb7113a9524d{gap:1px}.react-button.selected{background-color:var(--secondary-button-hover-bg-color);color:var(--secondary-button-color)!important}"})]})},V=e=>{let{message:a,reaction:t,selected:i,onHide:o}=e,l=(0,u.useT)(),{user:d}=(0,m.useUserContext)(),{messages:{onMessages:c}}=(0,w.useChatContext)();return(0,s.jsxs)("button",{type:"button",onClick:async()=>{if(!d)return;let e=a.reactions.filter(e=>e.user_api_id!==d.api_id);c([{...a,reactions:[...e,{reaction_type:t,user_api_id:d.api_id,removed_at:i?v.DateTime.now().toISO():null}]}]),o(),i?await z.APIClient.post("/chat/conversation/remove-reaction",{chat_message_api_id:a.api_id}):await z.APIClient.post("/chat/conversation/add-reaction",{chat_message_api_id:a.api_id,reaction_type:t})},"aria-label":l(i?{defaultMessage:"Remove {reaction}",id:"umJi3Q",description:"Chat. Label on a react button, removing an emoji-reaction from a message."}:{defaultMessage:"Add {reaction}",id:"vWxW7z",description:"Chat. Label on a react button, adding an emoji-reaction to a message."},{reaction:t}),className:"jsx-2b132e4413c77009 "+((0,n.default)("btn reaction-button",{selected:i})||""),children:[(0,s.jsx)("div",{className:"jsx-2b132e4413c77009 label",children:t}),(0,s.jsx)(r.default,{id:"2b132e4413c77009",children:".reaction-button.jsx-2b132e4413c77009{border:none;border-radius:1000px;flex:0;padding:0}.reaction-button.selected.jsx-2b132e4413c77009{border:1px solid var(--blue)}.reaction-button.jsx-2b132e4413c77009:hover,.reaction-button.selected.jsx-2b132e4413c77009:hover{background-color:var(--opacity-light)}.label.jsx-2b132e4413c77009{width:2.25rem;height:2.25rem;font-size:var(--font-size-xl);color:var(--primary-color);justify-content:center;align-items:center;display:flex}"})]})};var H=e.i(597066),G=e.i(998523);function Y(){return(Y=Object.assign.bind()).apply(null,arguments)}let q=e=>l.createElement("svg",Y({xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24"},e),t||(t=l.createElement("circle",{cx:12,cy:12,r:10})),i||(i=l.createElement("path",{d:"M12 8v4M12 16h.01"})));e.s(["default",0,q],657164);var K=e.i(923449);let Z=e=>{let{message:a}=e,t=(0,u.useT)(),[i,n]=(0,l.useState)(!1),{messages:{onDeleteMessage:o}}=(0,w.useChatContext)(),d=(0,K.useSendMessages)(),c=(0,l.useCallback)(async()=>{await (0,O.callWithToast)(async()=>{if(a.image){let e=null;"file"in a.image&&(e=await (0,K.createUploadableChatImage)(a.image.file)),await d({messages:[{api_id:a.api_id,image:e}],replying_to_message_api_id:a.replying_to_message_api_id})}else if(a.media){let e=null;"file"in a.media[0]&&(e=await (0,K.createUploadableChatVideo)(a.media[0].file)),await d({messages:[{api_id:a.api_id,media:[e]}],replying_to_message_api_id:a.replying_to_message_api_id})}else await d({messages:[{api_id:a.api_id,message:a.message}],replying_to_message_api_id:a.replying_to_message_api_id})},{error:t({defaultMessage:"Could not send chat message.",id:"+vHTwv",description:"Chat. Error toast."})})},[a,d,t]);return(0,s.jsx)(I.LuxMenu,{trigger:(0,s.jsxs)("button",{className:"jsx-74b1b055a6d404c4 with-svg btn btn-link error-button",children:[(0,s.jsx)(q,{}),(0,s.jsx)(r.default,{id:"74b1b055a6d404c4",children:".error-button.jsx-74b1b055a6d404c4{color:var(--error-color);flex-shrink:0}.error-button.jsx-74b1b055a6d404c4:not(:disabled):hover{color:var(--error-active-color);background:0 0}"})]}),open:i,setOpen:n,placement:"bottom-end",defaultSelectFirst:!1,rows:[{name:t({defaultMessage:"Try Again",id:"N+rhmA",description:"Chat. Failed message action."}),key:"retry",icon:(0,s.jsx)(H.Refresh16Icon,{}),onClick:async()=>{await c()}},{name:t({defaultMessage:"Delete Message",id:"lIOZuT",description:"Chat. Button CTA."}),key:"delete",icon:(0,s.jsx)(G.Trash16Icon,{}),onClick:async()=>{o(a.api_id)}}]})};var X=e.i(687836),Q=e.i(535707);let J=e=>{let{renderingMode:a,url:t}=e;return"none"===a?null:(0,s.jsxs)("div",{style:{width:Q.AVATAR_SIZE},className:"jsx-faceaea08a857f88 chat-message-avatar-wrapper",children:["show"===a&&(0,s.jsx)(X.Avatar,{px:Q.AVATAR_SIZE,url:t}),(0,s.jsx)(r.default,{id:"faceaea08a857f88",children:".chat-message-avatar-wrapper.jsx-faceaea08a857f88{margin-right:var(--chat-message-avatar-margin-right);flex-direction:row;flex-shrink:0;align-self:stretch;align-items:flex-end;display:flex}"})]})};var $=e.i(922323);let ee=e=>{let{replying_to_message_api_id:a,reply:t,sender:i,has_avatar:o}=e,{user:d}=(0,m.useUserContext)(),{messages:{entries:c}}=(0,w.useChatContext)(),u=(0,l.useMemo)(()=>{let e=c.find(e=>e.api_id===a);return e?{message:e}:void 0},[]),{data:h}=(0,f.useAPI)({path:"/chat/conversation/get-message",args:{chat_message_api_id:a},swrConfig:{fallbackData:u}});if(d)return(0,s.jsxs)("div",{className:"jsx-e737d024fce31c5d",children:[h&&(0,s.jsx)(ea,{original:h.message,reply:t,className:"current-user"===i?"text-right":""}),(0,s.jsx)("div",{className:"jsx-e737d024fce31c5d "+((0,n.default)("reply-bubble-container inline-block",{"other-user":"other-user"===i,"current-user":"current-user"===i,"has-avatar":o})||""),children:h?(0,s.jsx)("div",{className:"jsx-e737d024fce31c5d reply-bubble",children:(0,s.jsx)(T,{message:h.message,sender:(null==d?void 0:d.api_id)===h.message.user_api_id?"current-user":"other-user",isReply:!0})}):(0,s.jsx)(k,{})}),(0,s.jsx)(r.default,{id:"e737d024fce31c5d",children:'.reply-bubble-container.jsx-e737d024fce31c5d{margin:.125rem 0 .25rem;display:flex;position:relative}.reply-bubble-container.jsx-e737d024fce31c5d .reply-bubble.jsx-e737d024fce31c5d{opacity:.8;max-width:100%}.reply-bubble-container.current-user.jsx-e737d024fce31c5d .reply-bubble.jsx-e737d024fce31c5d{transform-origin:100%}.reply-bubble-container.other-user.jsx-e737d024fce31c5d .reply-bubble.jsx-e737d024fce31c5d{transform-origin:0}.reply-bubble-container.jsx-e737d024fce31c5d:before,.reply-bubble-container.jsx-e737d024fce31c5d:after{background:var(--divider-color);border-radius:var(--small-border-radius);width:2px;height:100%;position:absolute;top:0}.reply-bubble-container.other-user.jsx-e737d024fce31c5d{margin-left:-.4375rem;padding-left:.4375rem}.reply-bubble-container.other-user.has-avatar.jsx-e737d024fce31c5d{margin-left:-.625rem;padding-left:.625rem}.reply-bubble-container.other-user.jsx-e737d024fce31c5d:before{content:"";left:0}.reply-bubble-container.current-user.jsx-e737d024fce31c5d{justify-content:flex-end;margin-right:-.4375rem;padding-right:.4375rem}.reply-bubble-container.current-user.jsx-e737d024fce31c5d:before{content:"";right:0}'})]})},ea=e=>{var a,t,i,o,l,d,c,h,f,g,v,x;let{original:b,reply:_,className:j}=e,{user:y}=(0,m.useUserContext)(),w=(0,u.useT)();if(!y)return null;let C=b.user_api_id===y.api_id&&(null==(a=_.author)?void 0:a.user_api_id)===y.api_id,M=b.user_api_id===(null==(t=_.author)?void 0:t.user_api_id);return(0,s.jsxs)("div",{className:"jsx-92d3f868a0a36a29 "+((0,n.default)("reply-label text-tertiary-alpha fs-xs text-ellipses",j,{other:_.user_api_id!==y.api_id})||""),children:[C?(0,s.jsx)($.T,{defaultMessage:"You replied to yourself",description:"Label showing that you replied in a chat to your previous message",id:"3TWOOc"}):M?(0,s.jsx)($.T,{defaultMessage:"{reply_author} replied to themselves",description:"Label in a chat showing who replied to who.",id:"lYEiMO",values:{reply_author:(null==(o=_.author)||null==(i=o.user)?void 0:i.name)||w(p.CT.Anonymous)}}):b.user_api_id===y.api_id?(0,s.jsx)($.T,{defaultMessage:"{reply_author} replied to you",description:"Label in a chat showing who replied to who. The variables will be the names of each message author.",id:"WZqlXG",values:{reply_author:(null==(d=_.author)||null==(l=d.user)?void 0:l.name)||w(p.CT.Anonymous)}}):_.user_api_id===y.api_id?(0,s.jsx)($.T,{defaultMessage:"You replied to {original_author}",description:"Label in a chat showing who replied to who. The variables will be the names of each message author.",id:"Y5qHl5",values:{original_author:(null==(h=b.author)||null==(c=h.user)?void 0:c.name)||w(p.CT.Anonymous)}}):(0,s.jsx)($.T,{defaultMessage:"{reply_author} replied to {original_author}",description:"Label in a chat showing who replied to who. The variables will be the names of each message author.",id:"N/i1ln",values:{original_author:(null==(g=b.author)||null==(f=g.user)?void 0:f.name)||w(p.CT.Anonymous),reply_author:(null==(x=_.author)||null==(v=x.user)?void 0:v.name)||w(p.CT.Anonymous)}}),(0,s.jsx)(r.default,{id:"92d3f868a0a36a29",children:".other.jsx-92d3f868a0a36a29{margin-left:var(--chat-message-padding-inner)}.reply-label.jsx-92d3f868a0a36a29:not(.other){margin-right:var(--chat-message-padding-inner)}"})]})},et=e=>{var a,t,i;let{message:o,avatarRenderingMode:l="none",isMessageOfCurrentUser:d}=e,u=(0,c.useBoolean)(),h=o.reactions,p=null==h?void 0:h.filter(e=>!e.removed_at),m=(null!=(i=null==p?void 0:p.length)?i:0)>0,f=!!o.error;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{onMouseOver:u.setTrue,onMouseLeave:u.setFalse,onFocus:u.setTrue,onBlur:u.setFalse,className:"jsx-56b7609a93347f88 "+((0,n.default)("chat-message",{"chat-message-other":!d,"chat-message-has-error":o.error})||""),children:[(0,s.jsx)(J,{url:(null==(t=o.author)||null==(a=t.user)?void 0:a.avatar_url)||null,renderingMode:l}),(0,s.jsxs)("div",{className:"jsx-56b7609a93347f88 "+((0,n.default)("chat-message-content-container min-width-0",{"has-reactions":m,"has-reply":o.replying_to_message_api_id})||""),children:[o.replying_to_message_api_id&&(0,s.jsx)("div",{className:"jsx-56b7609a93347f88 reply-container full-width",children:(0,s.jsx)(ee,{replying_to_message_api_id:o.replying_to_message_api_id,reply:o,sender:d?"current-user":"other-user",has_avatar:"none"!==l})}),(0,s.jsxs)("div",{className:"jsx-56b7609a93347f88 "+((0,n.default)("bubble-container flex-center gap-1 min-width-0",d?"flex-row":"flex-row-reverse")||""),children:[(0,s.jsx)(F,{message:o,hovered:u.value}),(0,s.jsx)(T,{message:o,sender:d?"current-user":"other-user"}),f&&(0,s.jsx)(Z,{message:o})]}),p&&p.length>0&&(0,s.jsx)(ei,{chat_message_api_id:o.api_id,reactions:p,alignment:d?"right":"left"})]})]}),(0,s.jsx)(r.default,{id:"56b7609a93347f88",children:".chat-message.jsx-56b7609a93347f88{padding-left:var(--chat-message-padding-outer);padding-right:var(--chat-message-padding-inner);flex-direction:row-reverse;align-items:center;max-width:100%;display:flex}.chat-message-has-error.jsx-56b7609a93347f88 .bubble-container.jsx-56b7609a93347f88{margin-right:calc(-1*var(--chat-message-padding-inner))}.chat-message-other.jsx-56b7609a93347f88{padding-left:var(--chat-message-padding-inner);padding-right:var(--chat-message-padding-outer);flex-direction:row}.chat-message-content-container.jsx-56b7609a93347f88{flex-direction:column;align-items:flex-end;display:flex;position:relative}.chat-message-content-container.has-reactions.jsx-56b7609a93347f88{padding-bottom:1.25rem}.chat-message-content-container.has-reply.jsx-56b7609a93347f88{padding-top:.75rem}.chat-message-other.jsx-56b7609a93347f88 .chat-message-content-container.jsx-56b7609a93347f88{align-items:flex-start}.reply-container.jsx-56b7609a93347f88{--outer-padding:calc(var(--chat-message-avatar-size) + var(--chat-message-avatar-margin-right));padding-left:var(--outer-padding)}.chat-message-other.jsx-56b7609a93347f88 .reply-container.jsx-56b7609a93347f88{padding-left:0;padding-right:var(--outer-padding)}"})]})},ei=e=>{let{chat_message_api_id:a,reactions:t,alignment:i}=e,n=(0,u.useT)(),{user:c}=(0,m.useUserContext)(),g=t.find(e=>e.user_api_id===(null==c?void 0:c.api_id)),{data:v}=(0,f.useAPI)({path:"/chat/message/reactions",args:{chat_message_api_id:a},additionalKey:(0,o.default)(t)}),x=(0,l.useMemo)(()=>v?v.reactions.filter(e=>!e.reaction.removed_at).map(e=>{let{reaction:a,user:t}=e;return"".concat(a.reaction_type," ").concat(t.name||n(p.CT.Anonymous))}).join("\n"):"",[v,n]),b=(0,l.useMemo)(()=>{let e=new Set(t.filter(e=>!e.removed_at).map(e=>e.reaction_type));return(0,h.sort)(Array(...e)).join(" ")},[t]);return 0===t.length?null:(0,s.jsx)(d.LuxTooltip,{content:x,children:(0,s.jsxs)("div",{style:{["left"===i?"left":"right"]:"0.625rem"},className:"jsx-966811681a0ca308 reactions",children:[(0,s.jsxs)("div",{style:{borderColor:g?"var(--blue)":"var(--primary-bg-color)"},className:"jsx-966811681a0ca308 inner-reactions",children:[b,t.length>1&&(0,s.jsx)("span",{className:"jsx-966811681a0ca308 text-secondary-alpha ml-1",children:t.length})]}),(0,s.jsx)(r.default,{id:"966811681a0ca308",children:".reactions.jsx-966811681a0ca308{background:var(--elevated-secondary-bg-color);border:1px solid var(--primary-bg-color);border-radius:1rem;font-size:.75rem;line-height:1;position:absolute;bottom:.25rem}.inner-reactions.jsx-966811681a0ca308{cursor:default;border-style:solid;border-width:1px;border-radius:1rem;padding:.25rem .375rem}"})]})})}},306610,535707,480594,490151,322933,e=>{"use strict";e.s(["CHAT_WINDOW_FULL_SCREEN_DIMENSIONS",()=>eJ,"ChatOverlay",()=>e$],306610);var a,t,i=e.i(391398),s=e.i(359626),r=e.i(301027),n=e.i(374426),o=e.i(405155),l=e.i(29992),d=e.i(496712),c=e.i(47485),u=e.i(608239);e.s(["ChatWindow",()=>eZ],322933);var h=e.i(272043),p=e.i(538865),m=e.i(191788),f=e.i(254662),g=e.i(825881),v=e.i(660411),x=e.i(82602),b=e.i(86316),_=e.i(493502),j=e.i(723868),y=e.i(112544),w=e.i(355927);e.s(["AVATAR_SIZE",()=>F,"ChatMessageRenderer",()=>B],535707);var C=e.i(398050),M=e.i(655794),k=e.i(733191),T=e.i(915626);let S=e=>{let{name:a}=e;return(0,i.jsxs)("div",{className:"jsx-7f10c034722c9d79 fs-xs text-tertiary-alpha author-name text-ellipses",children:[a,(0,i.jsx)(s.default,{id:"7f10c034722c9d79",children:".author-name.jsx-7f10c034722c9d79{margin:.125rem 0;margin-left:calc(var(--chat-message-padding-inner) + var(--chat-message-avatar-size) + var(--chat-message-avatar-margin-right) + var(--chat-message-bubble-padding-horizontal));margin-right:var(--chat-message-padding-inner)}"})]})};var N=e.i(31197),A=e.i(922323);let I=e=>{let{show:a}=e;return(0,i.jsxs)(N.LuxCollapse,{show:a,children:[(0,i.jsx)("div",{className:"jsx-638af5a9e926d297 fs-xs chat-message-read-indicator text-tertiary-alpha",children:(0,i.jsx)(A.T,{defaultMessage:"Seen",id:"kZ2L1Q",description:"Chat. Seen indicator."})}),(0,i.jsx)(s.default,{id:"638af5a9e926d297",children:".chat-message-read-indicator.jsx-638af5a9e926d297{text-align:right;margin-top:1px;margin-right:var(--chat-message-read-indicator-margin-right)}"})]})};var P=e.i(344731),O=e.i(851800),L=e.i(9572);let E=e=>{let{date:a}=e,t=(0,b.useT)(),r=(0,O.useLocale)(),n=C.DateTime.fromISO(a,{locale:r}),o=(0,L.getCalendarFormat)({dt:n,format:L.CalendarFormat.Past,t,locale:r}),l=n.toLocaleString({hour:"numeric",minute:"2-digit"});return(0,i.jsxs)("div",{className:"jsx-36c6ab9a4ccdbc97 chat-time-group",children:[(0,i.jsx)(P.AfterMounted,{children:(0,i.jsx)(A.T,{defaultMessage:"{dmy}, {time}",id:"3hUNvP",description:"Chat. Session time. {dmy} will be a relative date like 'Today' or a full date like 'March 17, 2024', both localized. {time} will be localized time, e.g. '2:30 PM'.",values:{dmy:o,time:l}})}),(0,i.jsx)(s.default,{id:"36c6ab9a4ccdbc97",children:".chat-time-group.jsx-36c6ab9a4ccdbc97{text-align:center;color:var(--input-disabled-color);font-size:.75rem}"})]})};var R=e.i(41118);let U=e=>{let{message:a}=e;return(0,i.jsxs)("div",{className:"jsx-55f016e3289dbc9e chat-system-message",children:[(0,i.jsx)("div",{className:"jsx-55f016e3289dbc9e chat-message-content-container",children:(0,i.jsx)(z,{message:a})}),(0,i.jsx)(s.default,{id:"55f016e3289dbc9e",children:".chat-system-message.jsx-55f016e3289dbc9e{padding-left:var(--chat-message-padding-inner);padding-right:var(--chat-message-padding-inner);flex-direction:row;justify-content:center;align-items:center;display:flex}.chat-message-content-container.jsx-55f016e3289dbc9e{flex-direction:column;align-items:flex-end;max-width:100%;display:flex}"})]})},z=e=>{let{message:a}=e;return a.message?(0,i.jsx)(R.ChatTextBubble,{message:a,type:"system"}):null},D=C.Duration.fromObject({hours:1}),F=24,B=e=>{var a,t;let{message:r,previousMessage:n,nextMessage:o,conversationType:l,markAsSeen:d}=e,u=(0,b.useT)(),{currentUser:p}=(0,c.useChatContext)(),m=r.user_api_id===(null==p?void 0:p.api_id),f=C.DateTime.fromISO(r.sent_at),g=n?C.DateTime.fromISO(n.sent_at):null,v=o?C.DateTime.fromISO(o.sent_at):null,x=!g||f.diff(g)>D,_=x||(null==n?void 0:n.user_api_id)!==r.user_api_id,j=!v||v.diff(f)>D,y=(null==o?void 0:o.user_api_id)!==r.user_api_id||j,w="group"===l&&!m,N=w&&y,A=_&&"group"===l&&!m&&r.message_type===k.Chat.MessageType.User&&null===r.replying_to_message_api_id;return(0,i.jsxs)("div",{className:"jsx-2ee7a070144163f6 "+((0,h.default)("chat-message-wrapper",{"chat-message-wrapper-streak-end":y,"chat-message-wrapper-conversation-end":!o})||""),children:[x&&(0,i.jsx)("div",{className:"jsx-2ee7a070144163f6 chat-message-session-time",children:(0,i.jsx)(E,{date:r.sent_at})}),A&&(0,i.jsx)("div",{className:"jsx-2ee7a070144163f6",children:(0,i.jsx)(S,{name:(null==(t=r.author)||null==(a=t.user)?void 0:a.name)||u(M.CT.Anonymous)})}),r.message_type===k.Chat.MessageType.User?(0,i.jsx)(T.ChatMessage,{message:r,isMessageOfCurrentUser:m,avatarRenderingMode:w?N?"show":"transparent":"none"}):(0,i.jsx)(U,{message:r}),(0,i.jsx)(I,{show:d}),(0,i.jsx)(s.default,{id:"2ee7a070144163f6",children:".chat-message-wrapper.jsx-2ee7a070144163f6{margin-bottom:var(--chat-message-margin-bottom-same-author)}.chat-message-wrapper-streak-end.jsx-2ee7a070144163f6{margin-bottom:var(--chat-message-margin-bottom)}.chat-message-wrapper-conversation-end.jsx-2ee7a070144163f6{margin-bottom:0}.chat-message-session-time.jsx-2ee7a070144163f6{margin:var(--chat-session-time-margin)}"})]})};var W=e.i(441524),V=e.i(277386),H=e.i(839746),G=e.i(318797),Y=e.i(923449);let q=e=>{var a;let{info:t}=e,s=(0,b.useT)(),r="direct"===t.type&&t.other_participant||null,[n,o]=(0,m.useState)(null);(0,m.useEffect)(()=>{var e;(null==r?void 0:r.user_api_id)&&(null==(e=t.last_message)?void 0:e.user_api_id)===(null==r?void 0:r.user_api_id)&&o(null)},[t.last_message,null==r?void 0:r.user_api_id,o]);let l=(0,m.useCallback)(e=>{(null==r?void 0:r.user_api_id)&&e.type===V.RealTimeUpdateType.ChatParticipantIsTyping&&e.user_api_id===(null==r?void 0:r.user_api_id)&&o(new Date)},[null==r?void 0:r.user_api_id]);(0,H.useCentrifugeSubscription)({channel:r?(0,V.getRealTimeChannelForChatConversation)({chat_conversation_api_id:t.conversation.api_id}):void 0,onUpdate:l});let d=(0,G.useForceUpdate)();if((0,m.useEffect)(()=>{if(null===n)return;let e=setTimeout(()=>d(),Y.IS_TYPING_TIMEOUT_MS+50);return()=>{clearTimeout(e)}},[n,d]),!n)return!1;let c=new Date().getTime()-n.getTime()<Y.IS_TYPING_TIMEOUT_MS;return(0,i.jsx)(W.LuxFade,{show:c,className:"full-width",children:(0,i.jsx)("div",{className:"text-ellipses",children:(null==r||null==(a=r.user)?void 0:a.name)?s({defaultMessage:"{name} is typing…",id:"NwK0ep",description:"Chat. Typing indicator."},{name:r.user.name}):s({defaultMessage:"They are typing…",id:"xwOkkg",description:"Chat. Typing indicator."})})})};var K=e.i(684412),Z=e.i(424017),X=e.i(679905),Q=e.i(801560),J=e.i(318625),$=e.i(826420),ee=e.i(106946),ea=e.i(988124),et=e.i(653727);function ei(){return(ei=Object.assign.bind()).apply(null,arguments)}let es=e=>m.createElement("svg",ei({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},e),a||(a=m.createElement("path",{fill:"currentColor",d:"M1.528 1.404c.26-.26.683-.26.944 0l11.5 11.5a.667.667 0 0 1-.944.944l-.982-.983q-.251.028-.532.048c-.271 1.596-1.748 2.75-3.434 2.751-1.682 0-3.158-1.15-3.434-2.74-.752-.051-1.36-.13-1.84-.258-.54-.144-1.024-.373-1.36-.776-.348-.417-.448-.91-.448-1.388 0-1.08.698-1.718 1.033-2.15.35-.45.717-1.04.717-2.35 0-.646.132-1.357.384-2.046v-.004L1.529 2.348a.667.667 0 0 1 0-.944ZM9.94 12.982a90 90 0 0 1-3.719.006c.27.664.97 1.176 1.86 1.176.893 0 1.592-.515 1.86-1.182ZM4.345 5.164a4 4 0 0 0-.093.838c0 1.69-.508 2.6-1.033 3.274-.54.694-.717.805-.717 1.226 0 .272.056.373.1.425.054.065.196.18.591.286.823.22 2.278.287 4.807.287 1.047 0 1.916-.015 2.636-.045l-6.291-6.29ZM8 .25c1.783 0 3.115.902 3.977 2.05.847 1.13 1.275 2.54 1.275 3.702 0 1.31.367 1.9.717 2.35.335.432 1.033 1.07 1.033 2.15a.752.752 0 0 1-1.504 0c0-.42-.177-.532-.717-1.226-.525-.675-1.033-1.584-1.033-3.274 0-.837-.322-1.93-.975-2.799-.638-.851-1.556-1.45-2.773-1.45a3.23 3.23 0 0 0-1.938.62.752.752 0 0 1-.88-1.22A4.74 4.74 0 0 1 8 .25"})));e.s(["default",0,es],480594);var er=e.i(652465),en=e.i(523690),eo=e.i(964686),el=e.i(14118),ed=e.i(506039),ec=e.i(438728),eu=e.i(255499),eh=e.i(11096),ep=e.i(469891),em=e.i(442357),ef=e.i(645935);let eg=e=>{let{timezone:a,locale:t}=e;try{return new Intl.DateTimeFormat(t,{timeZone:a,hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(new Date)}catch(e){return null}},ev=e=>{let{timezone:a}=e,t=(0,O.useLocale)(),[s,r]=(0,m.useState)(eg({timezone:a,locale:t}));return((0,ef.usePolling)(()=>{r(eg({timezone:a,locale:t}))},1e3),s)?(0,i.jsx)("span",{children:s}):null};var ex=e.i(348688),eb=e.i(402818),e_=e.i(842044),ej=e.i(992354),ey=e.i(206046);function ew(){return(ew=Object.assign.bind()).apply(null,arguments)}let eC=e=>m.createElement("svg",ew({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},e),t||(t=m.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 1C4.14 1 1 4.046 1 7.79c.022 1.666.616 3.243 1.636 4.38.182.203.297.46.297.733V15l2.441-.714c.197-.057.406-.051.603.006.662.193 1.34.29 2.023.288 3.86 0 7-3.046 7-6.79S11.86 1 8 1"})));e.s(["default",0,eC],490151);var eM=e.i(295960),ek=e.i(704040),eT=e.i(145897),eS=e.i(687836),eN=e.i(581254),eA=e.i(836243);let eI=e=>{let{show:a,onHide:t,info:s}=e,r=(0,b.useT)();return(0,i.jsx)(ej.LuxModalContainer,{onHide:t,title:r({defaultMessage:"Participants",id:"bhlrEI",description:"Chat. Participants modal title."}),variant:"compact",children:a&&(0,i.jsx)("div",{children:(0,i.jsx)(eP,{info:s,onHide:t})})})},eP=e=>{var a;let{info:t,onHide:r}=e,{data:n,mutate:o}=(0,eN.useAPI)({path:"/chat/conversation/get-admins",args:{chat_conversation_api_id:t.conversation.api_id}}),{entries:l,loadMoreDiv:d,fetching:c,addEntries:u,filterEntries:h}=(0,eA.usePaginatedRequest)({path:"/chat/conversation/get-participants",args:{chat_conversation_api_id:t.conversation.api_id}}),p="admin"===t.my_participant.role,m=null==n?void 0:n.admins.filter(e=>null===e.removed_at&&"admin"===e.role),f=l.filter(e=>"admin"!==e.role&&!e.removed_at),g=e=>{u([{...e,api_id:e.user.api_id}]),o(a=>a?{admins:(0,eT.uniqBy)([...a.admins,e].toReversed(),e=>e.user_api_id).toReversed()}:a,{revalidate:!1})},v=e=>{h(a=>a.user_api_id!==e),o(a=>a?{admins:a.admins.filter(a=>a.user_api_id!==e)}:a,{revalidate:!1})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"jsx-74d717c3768fa857 fs-sm fw-medium text-tertiary-alpha mb-2",children:(0,i.jsx)(A.T,{defaultMessage:"Admins",id:"TfhXTS",description:"Chat. Participants modal. Admins section title."})}),null!=(a=null==m?void 0:m.map(e=>(0,i.jsx)("div",{className:"jsx-74d717c3768fa857 participant-row",children:(0,i.jsx)(eO,{info:t,isCurrentUserChatAdmin:p,participant:e,onHide:r,mutateParticipant:g,deleteParticipant:v})},e.user_api_id)))?a:(0,i.jsx)(eO.Loading,{}),f.length>0||c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"jsx-74d717c3768fa857 fs-sm fw-medium text-tertiary-alpha mb-2 mt-3",children:(0,i.jsx)(A.T,{defaultMessage:"Members",id:"PTWLD8",description:"Chat. Participants modal. Members section title."})}),f.map(e=>(0,i.jsx)("div",{className:"jsx-74d717c3768fa857 participant-row",children:(0,i.jsx)(eO,{info:t,isCurrentUserChatAdmin:p,participant:e,onHide:r,mutateParticipant:g,deleteParticipant:v})},e.user_api_id)),c&&(0,eT.range)(3).map(e=>(0,i.jsx)("div",{className:"jsx-74d717c3768fa857 participant-row",children:(0,i.jsx)(eO.Loading,{})},e))]}):null,d,(0,i.jsx)(s.default,{id:"74d717c3768fa857",children:".participant-row.jsx-74d717c3768fa857+.participant-row.jsx-74d717c3768fa857{margin-top:.75rem}"})]})},eO=e=>{let{info:a,participant:t,isCurrentUserChatAdmin:s,onHide:r,mutateParticipant:n,deleteParticipant:o}=e,l=(0,b.useT)(),{currentUser:d}=(0,c.useChatContext)(),u=t.user.name||l(M.CT.Anonymous),h=(0,Y.useStartChatWithUser)(),p=(0,Y.getConversationName)({info:a,t:l}),m=(0,ee.useModalState)();return(0,i.jsxs)("div",{className:"flex-center",children:[(0,i.jsx)(eS.Avatar,{url:t.user.avatar_url,px:40}),(0,i.jsxs)("div",{className:"participant flex-1 mx-25",children:[(0,i.jsx)("div",{className:"flex-center gap-2",children:(0,i.jsx)("div",{className:"text-ellipses fw-medium",children:u})}),t.user.timezone&&(0,i.jsxs)("div",{className:"text-tertiary-alpha gap-1 flex-center svg-sm fs-sm",children:[(0,i.jsx)(ec.default,{}),(0,i.jsx)(ev,{timezone:t.user.timezone})]})]}),s&&t.user.api_id!==(null==d?void 0:d.api_id)?(0,i.jsx)(e_.ActionMenuButton,{rounded:!0,size:"small",color:"secondary",compact:!0,options:[{key:"start-chat",name:l({defaultMessage:"Direct Message",id:"p19SFb",description:"CTA to open direct message with a user."}),icon:(0,i.jsx)(eC,{}),onClick:async()=>{r(),await h(t.user)}},"admin"!==t.role?{key:"make-admin",name:l({defaultMessage:"Promote to Admin",id:"d09Muz",description:"Chat. Participants modal. Promote member to chat admin button."}),icon:(0,i.jsx)(eM.Crown16Icon,{}),onClick:async()=>{n({...t,role:"admin"});let{error:e}=await (0,ea.callWithToast)(ex.APIClient.post("/chat/participant/update",{chat_conversation_api_id:a.conversation.api_id,user_api_id:t.user_api_id,role:"admin"}),{success:l({defaultMessage:"{name} is now a chat admin.",id:"zLt5uY",description:"Chat. Participants modal. Success message when promoting a participant to admin."},{name:u}),error:l({defaultMessage:"There was a problem promoting the participant to admin.",id:"INb5qC",description:"Chat. Participants modal. Error message when promoting a participant to admin."})});e&&n({...t,role:null})}}:{key:"demote-admin",name:l({defaultMessage:"Change to Member",id:"U96HNZ",description:"Chat. Participants modal. Demote chat admin to member button."}),icon:(0,i.jsx)(ek.User16Icon,{}),onClick:async()=>{n({...t,role:null});let{error:e}=await (0,ea.callWithToast)(ex.APIClient.post("/chat/participant/update",{chat_conversation_api_id:a.conversation.api_id,user_api_id:t.user_api_id,role:null}),{success:l({defaultMessage:"{name} is no longer a chat admin.",id:"PkFGwp",description:"Chat. Participants modal. Success message when demoting a chat admin to member."},{name:u}),error:l({defaultMessage:"There was a problem changing the participant to member.",id:"R8iNUA",description:"Chat. Participants modal. Error message when changing a participant to member."})});e&&n({...t,role:"admin"})}},{key:"remove",name:l({defaultMessage:"Remove from Chat",id:"+onmHV"}),color:"error",icon:(0,i.jsx)(eo.UserMinus16Icon,{}),onClick:m.onShow}]}):t.user.api_id!==(null==d?void 0:d.api_id)?(0,i.jsx)(Z.LuxButton,{size:"small",icon:(0,i.jsx)(eC,{}),color:"light",rounded:!0,label:l(M.CT.Chat),onClick:()=>{h(t.user),r()}}):null,(0,i.jsx)(K.DeleteConfirmationModal,{...m,icon:(0,i.jsx)(eu.UserMinusModalIcon,{}),title:l({defaultMessage:"Remove Participant",id:"zxwlG6",description:"Chat. Participants modal. Remove participant modal title."}),subtitle:u,text:l({defaultMessage:"Are you sure you want to remove {name} from {conversation_name}?",id:"jgdW46",description:"Chat. Participants modal. Remove participant modal text."},{name:u,conversation_name:p}),actionButtonTitle:l(M.CT.Confirm),onConfirm:async()=>{n({...t,removed_at:C.DateTime.now().toISO()});let{error:e}=await (0,ea.callWithToast)(ex.APIClient.post("/chat/participant/update",{chat_conversation_api_id:a.conversation.api_id,user_api_id:t.user_api_id,remove:!0}),{error:l({defaultMessage:"There was a problem removing the participant.",id:"2F2Itx",description:"Chat. Participants modal. Error message when removing a participant."})});e?n({...t,removed_at:null}):o(t.user_api_id)}})]})};eO.Loading=()=>(0,i.jsxs)("div",{className:"flex-center",style:{gap:"0.75rem"},children:[(0,i.jsx)(ey.Shimmer,{width:40,height:40,shape:"circle"}),(0,i.jsxs)("div",{className:"flex-column gap-2",children:[(0,i.jsx)(ey.Shimmer,{width:"10rem",height:"1rem"}),(0,i.jsx)(ey.Shimmer,{width:"7rem",height:"0.75rem"})]})]});var eL=e.i(6855),eE=e.i(629075),eR=e.i(454657),eU=e.i(883720),ez=e.i(465028);let eD=e=>{let{show:a,onHide:t,info:s}=e,r=(0,b.useT)(),n=(0,$.useBoolean)(),o=(0,$.useBoolean)();return(0,i.jsx)(ej.LuxModalContainer,{onHide:t,variant:"lux-alert",title:r({defaultMessage:"Edit Chat",id:"v/lq40",description:"Chat. Edit chat conversation modal title."}),canClickOutToDismiss:!n.value,children:a&&(0,i.jsx)(p.Formik,{initialValues:{avatar_url:s.conversation.avatar_url,name:s.conversation.name},onSubmit:async e=>{if(o.value)return;let{error:a}=await (0,ea.callWithToast)(async()=>{await ex.APIClient.post("/chat/group/update",{chat_conversation_api_id:s.conversation.api_id,...e})},{error:r({defaultMessage:"Failed to update conversation.",id:"CbqGII",description:"Chat. Error updating conversation."})});a||t()},children:e=>{let{values:a,setFieldValue:t}=e;return(0,i.jsxs)(p.Form,{className:"flex-column gap-3",children:[(0,i.jsx)(eE.FormikChangeListener,{setDirty:n.setValue}),(0,i.jsx)(eL.AvatarUploader,{url:a.avatar_url,size:64,onUpload:e=>{let{file_url:a}=e;return t("avatar_url",a)},onUploadChange:e=>{let{isUploading:a}=e;return o.setValue(a)},createPresignedUrl:ez.createPresignedUrl,fallback:(0,i.jsx)(eb.ChatConversationAvatar,{px:64,info:s})}),(0,i.jsx)(eR.LuxInputField,{name:"name",label:r({defaultMessage:"Chat Name",id:"obVUd5",description:"Chat. Edit group chat name field label."}),placeholder:r({defaultMessage:"Friday Night Out",id:"LfmNkR",description:"Chat. Edit group chat name field placeholder."}),suppress1Password:!0}),(0,i.jsx)(eU.LuxSubmitButton,{label:r(M.CT.Save),fullWidth:!0,disabled:o.value})]})}})})};var eF=e.i(427133),eB=e.i(715512),eW=e.i(14978);let eV=e=>{let{show:a,onHide:t,info:s}=e;return(0,i.jsx)(ej.LuxModalContainer,{onHide:t,variant:"lux-alert",children:a&&(0,i.jsx)(eH,{info:s,onHide:t})})},eH=e=>{let{info:a,onHide:t}=e,r=(0,b.useT)(),{conversationsState:n}=(0,c.useChatContext)(),[o,l]=(0,m.useState)("1h"),d=async e=>{let{error:i}=await (0,ea.callWithToast)(ex.APIClient.post("/chat/conversation/mute",{chat_conversation_api_id:a.conversation.api_id,mute_until:"forever"===e?"forever":C.DateTime.now().plus(e).toISO()}),{error:r({defaultMessage:"Failed to mute chat",id:"IdYWLX",description:"Chat. Error message when we fail to mute or unmute a chat."})});await n.refresh(),i||t()};return(0,i.jsxs)("div",{className:"jsx-d397d0e5a59015a2",children:[(0,i.jsx)(eF.LuxAlertTop,{icon:(0,i.jsx)(eW.BellModalIcon,{}),title:r({defaultMessage:"Mute Chat",id:"9R60AK",description:"Chat. 'Mute Chat' modal title."}),desc:r({defaultMessage:"Too much going on? Mute the conversation to pause or stop notifications for it.",id:"xDBzEX"}),onHide:t,className:"mb-25"}),(0,i.jsx)(eB.LuxInputLabel,{text:r({defaultMessage:"Mute for",id:"ob9Xhs",description:"Label for options to mute a conversaton for, like 1h, 1d, etc."})}),(0,i.jsxs)("div",{className:"jsx-d397d0e5a59015a2 flex-center gap-1 mb-2",children:[(0,i.jsx)(Z.LuxButton,{label:r({defaultMessage:"1H",id:"nIEhBA",description:"Label for 1 hour. Keep this short."}),fullWidth:!0,color:"light",className:(0,h.default)("duration-btn",{selected:"1h"===o}),onClick:()=>l("1h")}),(0,i.jsx)(Z.LuxButton,{label:r({defaultMessage:"1D",id:"XKHs0l",description:"Label for 1 day. Keep this short."}),fullWidth:!0,color:"light",className:(0,h.default)("duration-btn",{selected:"1d"===o}),onClick:()=>l("1d")}),(0,i.jsx)(Z.LuxButton,{label:r({defaultMessage:"7D",id:"2UkajW",description:"Label for 7 days / 1 week. Keep this short."}),fullWidth:!0,color:"light",className:(0,h.default)("duration-btn",{selected:"7d"===o}),onClick:()=>l("7d")})]}),(0,i.jsx)(Z.LuxButton,{label:r({defaultMessage:"Mute Conversation",id:"RJ1xAW",description:"Chat. Mute chat modal. CTA on a button muting chat for 1 week."}),fullWidth:!0,onClick:()=>{let e={hours:1};"1d"===o?e={days:1}:"7d"===o&&(e={weeks:1}),d(e)}}),(0,i.jsx)("hr",{className:"jsx-d397d0e5a59015a2"}),(0,i.jsx)(Z.LuxButton,{label:r({defaultMessage:"Mute Forever",id:"cySk/h",description:"Chat. Mute chat modal. CTA on a button muting chat forever."}),fullWidth:!0,color:"light",onClick:()=>d("forever")}),(0,i.jsx)(s.default,{id:"d397d0e5a59015a2",children:"div.jsx-d397d0e5a59015a2 hr.jsx-d397d0e5a59015a2{margin:.75rem calc(-1*var(--modal-horizontal-padding))}div.jsx-d397d0e5a59015a2 .duration-btn.selected,div.jsx-d397d0e5a59015a2 .duration-btn.selected:hover{color:var(--primary-color)!important;border-color:var(--primary-color)!important;background-color:transparent!important}"})]})},eG={rounded:!0,color:"secondary",variant:"naked",hideTooltipForIconOnly:!0,iconPlacement:"icon-only-compact",size:"small"},eY=e=>{let{info:a,onBack:t,onClose:r,hideCloseButton:n}=e,o=(0,b.useT)(),l=(0,ee.useModalState)(),d=(0,ee.useModalState)(),c=(0,ee.useModalState)();return(0,i.jsxs)("div",{className:"jsx-d9652d13ff7c47c2 chat-header flex-center",children:[t&&(0,i.jsx)(Z.LuxButton,{icon:(0,i.jsx)(ed.default,{}),onClick:t,label:o(M.CT.Back),...eG}),(0,i.jsx)("div",{className:"jsx-d9652d13ff7c47c2 flex-1",children:(0,i.jsx)(eq,{info:a,onOpenParticipantModal:l.onShow})}),(0,i.jsx)(eK,{info:a,closeConversation:r,onOpenParticipantsModal:l.onShow,onOpenMuteModal:d.onShow,onEditChatModal:c.onShow}),!n&&(0,i.jsx)(Z.LuxButton,{icon:(0,i.jsx)(ep.default,{}),onClick:r,label:o(M.CT.Close),className:"ml-1",...eG}),(0,i.jsx)(eI,{...l,info:a}),(0,i.jsx)(eV,{...d,info:a}),(0,i.jsx)(eD,{...c,info:a}),(0,i.jsx)(s.default,{id:"d9652d13ff7c47c2",children:".chat-header.jsx-d9652d13ff7c47c2{background:var(--bg-opacity-48);border-bottom:1px solid var(--divider-color);padding:.375rem .75rem .375rem .5rem}"})]})},eq=e=>{let{info:a,onOpenParticipantModal:t}=e,{conversation:r}=a,n=(0,b.useT)(),o=(0,Y.getConversationName)({info:a,t:n}),l=(0,Y.getConversationTimezone)({info:a}),d="group"===r.type?(0,i.jsx)(A.T,{defaultMessage:"{num_participants, plural, one {# participant} other {# participants}}",id:"6wjw/L",description:"Group chat participants count label.",values:{num_participants:r.num_participants}}):null,c=a.other_participant?em.LumaRoutes.profileUrl({user:a.other_participant.user}):void 0,u=(0,i.jsxs)("div",{className:"jsx-4a87c27ad586d946 chat-conversation flex-center min-width-0",children:[(0,i.jsx)(J.OptionalLink,{href:c,children:(0,i.jsx)("div",{className:"jsx-4a87c27ad586d946 avatar",children:(0,i.jsx)(eb.ChatConversationAvatar,{info:a,px:32})})}),(0,i.jsxs)("div",{className:"jsx-4a87c27ad586d946 chat-conversation-name reduced-line-height",children:[(0,i.jsx)(J.OptionalLink,{href:c,children:(0,i.jsx)("div",{className:"jsx-4a87c27ad586d946 flex-1 text-primary fw-medium text-ellipses",children:o})}),(0,i.jsx)("div",{className:"jsx-4a87c27ad586d946 flex-1 participant-details text-tertiary-alpha flex-center fs-xs svg-xs",children:d?(0,i.jsx)(i.Fragment,{children:d}):l?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ec.default,{})," ",(0,i.jsx)(ev,{timezone:l})]}):null})]}),(0,i.jsx)(s.default,{id:"4a87c27ad586d946",children:".chat-conversation.jsx-4a87c27ad586d946{gap:.625rem;padding:.25rem .375rem}.avatar.jsx-4a87c27ad586d946{padding:.1875rem 0}.chat-conversation-name.jsx-4a87c27ad586d946{min-width:0;color:var(--primary-color)}"})]}),h=null;return("event"===r.context.type&&(h=em.LumaRoutes.event.publicPath({event:{api_id:r.context.event_api_id}})),h)?(0,i.jsxs)("div",{className:"jsx-a1dd5579dd964b23 link-wrapper",children:[(0,i.jsx)(X.LuxLink,{href:h,children:u}),(0,i.jsx)(s.default,{id:"a1dd5579dd964b23",children:".link-wrapper.jsx-a1dd5579dd964b23 a{border-radius:var(--border-radius);display:block}.link-wrapper.jsx-a1dd5579dd964b23 a:hover{background:var(--hover-bg-color)}"})]}):"group"===r.type?(0,i.jsx)("button",{className:"button-reset full-width",onClick:t,children:u}):u},eK=e=>{let{info:a,closeConversation:t,onOpenParticipantsModal:s,onOpenMuteModal:r,onEditChatModal:n}=e,{conversationsState:o}=(0,c.useChatContext)(),l=(0,$.useBoolean)(),d=(0,ee.useModalState)(),u=(0,b.useT)(),{conversation:h}=a,p=(0,Y.useIsChatMuted)({info:a}),m=["group"===h.type&&h.event_api_id&&{key:"open-page",icon:(0,i.jsx)(er.Calendar16Icon,{}),name:u({defaultMessage:"Open Event Page",id:"h9+xfQ",description:"Chat window header 'more' menu. CTA to open related page of the event related to the conversation."}),href:em.LumaRoutes.event.publicPath({event:{api_id:h.event_api_id}})},"group"===h.type&&{key:"list-participants",icon:(0,i.jsx)(el.Users16Icon,{}),name:u({defaultMessage:"Open Participants List",id:"N7qc0x",description:"Chat window header 'more' menu. CTA to open participants list of the conversation."}),onClick:s},p?{key:"unmute-chat",icon:(0,i.jsx)(et.Bell16Icon,{}),name:u({defaultMessage:"Unmute Chat",id:"c3acuX",description:"Chat window header 'more' menu. CTA to unmute the conversation."}),onClick:async()=>{await (0,ea.callWithToast)(ex.APIClient.post("/chat/conversation/mute",{chat_conversation_api_id:h.api_id,mute_until:null}),{error:u({defaultMessage:"Failed to unmute chat.",id:"T1bipD",description:"Chat. Unmute chat action error message."})}),await o.refresh()}}:{key:"mute-chat",icon:(0,i.jsx)(es,{}),name:u({defaultMessage:"Mute Chat",id:"ob8xl1",description:"Chat window header 'more' menu. CTA to mute the conversation."}),onClick:r},"group"===h.type&&"admin"===a.my_participant.role&&null===h.event_api_id&&{key:"edit-chat",icon:(0,i.jsx)(en.Edit16Icon,{}),name:u({defaultMessage:"Edit Chat",id:"xSeF1K",description:"Chat. 'More' button action."}),onClick:n},"group"===h.type&&null===h.event_api_id&&{key:"leave-chat",color:"error",icon:(0,i.jsx)(eo.UserMinus16Icon,{}),name:u({defaultMessage:"Leave Chat",id:"kqqGa9",description:"Chat window header 'more' menu. CTA to leave the conversation."}),onClick:d.onShow}].filter(Boolean);return 0===m.length?null:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Q.LuxMenu,{rows:m,open:l.value,setOpen:l.setValue,placement:"bottom-end",aboveChatWindow:!0,trigger:(0,i.jsx)("div",{children:(0,i.jsx)(Z.LuxButton,{label:u({defaultMessage:"More",id:"OUNWib",description:"Chat. 'More' button label."}),icon:(0,i.jsx)(eh.default,{}),...eG})})}),(0,i.jsx)(K.DeleteConfirmationModal,{...d,text:u({defaultMessage:"Are you sure you want to leave {conversation_name}?",id:"pUhx+x",description:"Chat. Leave chat modal text."},{conversation_name:(0,Y.getConversationName)({info:a,t:u})}),icon:(0,i.jsx)(eu.UserMinusModalIcon,{}),title:u({defaultMessage:"Leave Chat",id:"Y5d2RW",description:"Chat. Leave chat modal title."}),actionButtonTitle:u({defaultMessage:"Leave",id:"SrDFDB",description:"Chat. Leave chat button CTA."}),onConfirm:async()=>{t(),await (0,ea.callWithToast)(ex.APIClient.post("/chat/conversation/leave",{chat_conversation_api_id:h.api_id}),{error:u({defaultMessage:"Failed to leave chat. Please try again later.",id:"TYvOeY",description:"Chat. Leave chat modal error message."})}),await o.refresh()}})]})},eZ=e=>{let{onBack:a,onClose:t,hideCloseButton:r,composerMaxRows:o=3,info:l}=e,d=(0,b.useT)(),u=(0,f.useIsMobileBrowser)(),{currentUser:h,conversationsState:j,messages:C,replyingToMessage:M,setReplyingToMessage:k}=(0,c.useChatContext)(),T=null==h?void 0:h.api_id,S=(0,Y.useSendMessages)(),{fetchOlder:N,entries:A,hasOlder:I,isLoadingInitialMessages:P,isLoadingOlderMessages:O}=C,{conversation:L}=l,E=(0,Y.useMarkConversationAsRead)(l.conversation.api_id);(0,g.useOnFocus)(E);let R=(0,m.useRef)(null),U=(0,m.useRef)(null),z=(0,m.useRef)(null),D=(0,m.useRef)(null),F=(0,v.useOnScreen)(U),W=(0,_.useWindowFocus)(),V=(0,v.useOnScreen)(D),H=j.unreadConversations.has(l.conversation.api_id);(0,m.useEffect)(()=>{H&&V&&W&&E()},[H,V,W,E]),(0,m.useEffect)(()=>{F&&I&&!O&&N()},[F,O,N,I]);let G="direct"===l.type?A.find(e=>e.user_api_id===T&&e.sent_at<=l.other_participant.last_read_chat_message_sent_at):null,K=A[0];(0,m.useEffect)(()=>{let e=z.current;if(!e)return;let a=(null==K?void 0:K.user_api_id)!==T,t=e.scrollTop>-120;a&&t&&(e.scrollTop=0)},[K,T,z]);let Z=A.flatMap((e,a,t)=>(0,i.jsx)(B,{message:e,previousMessage:t[a+1],nextMessage:t[a-1],conversationType:null==l?void 0:l.type,markAsSeen:(null==G?void 0:G.api_id)===e.api_id},e.api_id)),{message:X,update:Q}=(0,Y.useChatDraft)(L.api_id);return(0,i.jsx)(p.Formik,{initialValues:{message:null!=X?X:"",media:null},onSubmit:async(e,a)=>{var t;let{resetForm:i}=a;if(!(0,Y.isChatMessageValid)(e))return;z.current&&(z.current.scrollTop=0);let s=null!=(t=null==M?void 0:M.api_id)?t:null;k(null);let r=e.media&&"video"===e.media.type?{media:[e.media],api_id:eX()}:null,n=e.media&&!r?{image:e.media,api_id:eX()}:null,o=e.message?{message:e.message,api_id:eX()}:null;S({messages:(s?[o,n,r]:[r,n,o]).flatMap(e=>e&&("image"in e&&e.image||"message"in e&&e.message.trim().length>0||"media"in e&&e.media.length>0)?e:[]),replying_to_message_api_id:s}).catch(()=>{(0,x.toastError)(d({defaultMessage:"Could not send chat message.",id:"+vHTwv",description:"Chat. Error toast."}))}),i({values:{message:"",media:null}}),setTimeout(()=>{var e;null==(e=R.current)||e.focus()},0)},children:(0,i.jsxs)("div",{className:"jsx-4a671e9eac332880 chat-window flex-column",children:[(0,i.jsx)(eY,{info:l,onBack:a,onClose:t,hideCloseButton:r}),(0,i.jsx)(w.ChatMessageDropzone,{children:(0,i.jsxs)("div",{ref:z,onTouchStart:u?()=>R.current.blur():void 0,className:"jsx-4a671e9eac332880 chat-messages overflow-auto",children:[(0,i.jsx)("div",{ref:D,className:"jsx-4a671e9eac332880"}),P&&(0,i.jsx)("div",{className:"jsx-4a671e9eac332880 flex-1 with-svg",children:(0,i.jsx)(n.Spinner,{})}),Z.slice(0,-5),(0,i.jsx)("div",{ref:U,className:"jsx-4a671e9eac332880"}),Z.slice(-5),I&&!P&&(0,i.jsx)(eQ,{className:"py-3"})]})}),(0,i.jsx)(y.ChatMessageComposer,{ref:R,disabled:!!L.archived_at,onChange:Q,maxRows:o}),(0,i.jsx)("div",{className:"jsx-4a671e9eac332880 status-bar-wrapper",children:(0,i.jsxs)("div",{className:"jsx-4a671e9eac332880 status-bar",children:[!L.archived_at&&(0,i.jsx)(q,{info:l}),L.archived_at&&(0,i.jsx)("div",{className:"jsx-4a671e9eac332880 text-ellipses",children:d({defaultMessage:"This conversation has been archived.",id:"radI57",description:"Chat. Archived conversation label."})})]})}),(0,i.jsx)(s.default,{id:"4a671e9eac332880",children:".chat-window.jsx-4a671e9eac332880{max-height:100%;padding-bottom:env(safe-area-inset-bottom);background:var(--chat-window-background);flex:1;position:relative;overflow:auto}.chat-messages.jsx-4a671e9eac332880{flex-direction:column-reverse;flex:1;padding-bottom:.25rem;display:flex}.status-bar-wrapper.jsx-4a671e9eac332880{width:100%;position:absolute;bottom:0}.status-bar.jsx-4a671e9eac332880{color:var(--tertiary-color-alpha);align-items:center;padding:.125rem .75rem;font-size:.625rem;line-height:calc(.625rem + 1px);display:flex}"})]})})},eX=()=>"chatmsg-".concat((0,j.randomString)(15)),eQ=e=>{let{className:a}=e,t=(0,m.useRef)(null),s=(0,v.useOnScreen)(t);return(0,i.jsx)("div",{ref:t,className:(0,h.default)("with-svg",a),children:(0,i.jsx)(n.Spinner,{pause:!s})})},eJ={width:o.ResponsiveBreakpointNumbers.small,height:400},e$=e=>{let{isWindowOpen:a,closeWindow:t,openConversation:h,openConversationApiId:p}=e,{conversationsState:m}=(0,c.useChatContext)(),{conversations:f}=m,g=(null==f?void 0:f.slice(0,3).reverse())||[],v=(null==f?void 0:f.filter(e=>{let{conversation:a}=e;return m.unreadConversations.has(a.api_id)}).length)||0,x=null==f?void 0:f.find(e=>{let{conversation:a}=e;return a.api_id===p});return(0,i.jsxs)("div",{className:s.default.dynamic([["63cdf56a2835da2b",[o.ResponsiveBreakpoint.tiny,eJ.width,eJ.height,o.ResponsiveBreakpoint.large]]])+" chat-overlay-container",children:[a&&(0,i.jsxs)("div",{className:s.default.dynamic([["63cdf56a2835da2b",[o.ResponsiveBreakpoint.tiny,eJ.width,eJ.height,o.ResponsiveBreakpoint.large]]])+" chat-window-wrapper",children:[!p&&(0,i.jsx)(u.ChatsWindow,{onClose:t}),p&&x&&(0,i.jsx)(eZ,{info:x,onBack:()=>h(null),onClose:t},x.conversation.api_id),p&&!x&&(0,i.jsx)("div",{onClick:t,className:s.default.dynamic([["63cdf56a2835da2b",[o.ResponsiveBreakpoint.tiny,eJ.width,eJ.height,o.ResponsiveBreakpoint.large]]])+" flex-1 with-svg",children:(0,i.jsx)(n.Spinner,{})})]}),(0,i.jsxs)("div",{className:s.default.dynamic([["63cdf56a2835da2b",[o.ResponsiveBreakpoint.tiny,eJ.width,eJ.height,o.ResponsiveBreakpoint.large]]])+" chat-fabs-wrapper",children:[(0,i.jsx)(r.m.div,{className:"chat-heads-wrapper",layout:!0,layoutRoot:!0,children:g.map(e=>(0,i.jsx)(r.m.div,{layout:!0,className:"chat-fabs-head",children:(0,i.jsx)(l.ChatConversationHead,{info:e,isUnread:m.unreadConversations.has(e.conversation.api_id),isActive:a&&p===e.conversation.api_id,onClick:()=>h(e.conversation.api_id)})},e.conversation.api_id))}),(0,i.jsx)("div",{className:s.default.dynamic([["63cdf56a2835da2b",[o.ResponsiveBreakpoint.tiny,eJ.width,eJ.height,o.ResponsiveBreakpoint.large]]])+" chat-launcher-wrapper",children:(0,i.jsx)(d.ChatLauncherButton,{onClick:()=>{null==p&&a?t():h(null)},unreadConversationsCount:v})})]}),(0,i.jsx)(s.default,{id:"63cdf56a2835da2b",dynamic:[o.ResponsiveBreakpoint.tiny,eJ.width,eJ.height,o.ResponsiveBreakpoint.large],children:".chat-overlay-container.__jsx-style-dynamic-selector{width:100%;height:100%;z-index:calc(var(--overlay-z-index) + 1);pointer-events:none;flex-direction:row;justify-content:flex-end;align-items:flex-end;display:flex;position:fixed;top:0;left:0}.chat-window-wrapper.__jsx-style-dynamic-selector,.chat-fabs-wrapper.__jsx-style-dynamic-selector{transition:all var(--fast-transition-duration)var(--bounce-transition-fn);transform-origin:100% 100%}body.scroll-locked .chat-overlay-container.__jsx-style-dynamic-selector{z-index:calc(var(--overlay-z-index) - 1)}body.full-screen-modal-open .chat-window-wrapper.__jsx-style-dynamic-selector,body.full-screen-modal-open .chat-fabs-wrapper.__jsx-style-dynamic-selector{pointer-events:none;opacity:0;transform:scale(.95)}@media (max-width:".concat(o.ResponsiveBreakpoint.tiny,"){body.full-screen-modal-open-on-mobile .chat-window-wrapper.__jsx-style-dynamic-selector,body.full-screen-modal-open-on-mobile .chat-fabs-wrapper.__jsx-style-dynamic-selector{pointer-events:none;opacity:0;transform:scale(.95)}}.chat-fabs-wrapper.__jsx-style-dynamic-selector{opacity:1;pointer-events:auto;flex-direction:column;align-items:center;margin-bottom:1.5rem;margin-right:1.5rem;display:flex;position:relative}.chat-fabs-wrapper.__jsx-style-dynamic-selector .chat-heads-wrapper{background-color:var(--bg-opacity-48);box-shadow:var(--chat-box-shadow);-webkit-backdrop-filter:var(--backdrop-blur);backdrop-filter:var(--backdrop-blur);outline:1px solid var(--opacity-light);border-radius:48px}.chat-launcher-wrapper.__jsx-style-dynamic-selector{margin-top:8px}.chat-window-wrapper.__jsx-style-dynamic-selector{border-radius:var(--modal-border-radius);width:22rem;max-width:calc(100vw - 4rem);height:30rem;max-height:calc(100vh - 8.5rem);box-shadow:var(--shadow);pointer-events:auto;background:var(--chat-window-background);outline:1px solid var(--divider-color);-webkit-backdrop-filter:var(--backdrop-blur);backdrop-filter:var(--backdrop-blur);border-bottom-right-radius:0;border-bottom-left-radius:0;flex-direction:column;margin-right:1.5rem;display:flex;position:relative;overflow:hidden}@media screen and (max-width:").concat(eJ.width,"px),screen and (max-height:").concat(eJ.height,"px){.chat-window-wrapper.__jsx-style-dynamic-selector{max-width:none;max-height:none;box-shadow:none;z-index:var(--chat-z-index);width:100vw;height:100vh;border-radius:0;outline:0;height:-webkit-fill-available;margin-right:0;position:absolute;top:0;left:0}html{height:-webkit-fill-available}.chat-fabs-head{display:none}}@media (max-width:").concat(o.ResponsiveBreakpoint.large,"){.chat-fabs-head{display:none}}")})]})}},47485,e=>{"use strict";e.s(["ChatContext",()=>A,"ChatProvider",()=>I,"useChatContext",()=>P],47485);var a=e.i(391398),t=e.i(191788),i=e.i(825881),s=e.i(974714),r=e.i(602533),n=e.i(86316),o=e.i(145897),l=e.i(655794),d=e.i(277386),c=e.i(605532),u=e.i(829900),h=e.i(579865),p=e.i(348688),m=e.i(839746),f=e.i(836243),g=e.i(402818),v=e.i(306610),x=e.i(923449),b=e.i(877182),_=e.i(398050),j=e.i(729506),y=e.i(821384),w=e.i(645935),C=e.i(149230),M=e.i(271416),k=e.i(672183);let T="luma.active-tab-info",S=y.z.object({updated:y.z.string(),tabId:y.z.string()}),N=(e,a)=>{if(!e)return a;if(!a)return e;let t=_.DateTime.fromISO(e),i=_.DateTime.fromISO(a);return(t>i?t:i).toUTC().toISO()},A=t.default.createContext({currentUser:null,isChatWindowOpen:!1,closeChatWindow:()=>null,openConversation:()=>null,conversationsState:{},replyingToMessage:null,setReplyingToMessage:()=>{},messages:{},openConversationApiId:null}),I=i=>{let{disabled:r,children:f,shouldShowOverlay:y}=i,I=(0,n.useT)(),{user:P}=(0,u.useUserContext)(),[L,E]=(0,t.useState)(!1),[R,U]=(0,t.useState)(null),[z,D]=(0,t.useState)(null),F=(a=>{let{pause:i}=a,[s,r]=(0,t.useState)({conversations:[],loading:!0}),{user:n}=(0,u.useUserContext)(),{handleUpdate:l}=(a=>{let{conversations:i}=a,{user:s}=(0,u.useUserContext)(),{play:r}=function(a){let i=(0,t.useRef)(null),[s,r]=(0,t.useState)(null);return(0,k.useOnMount)(()=>{e.A(246563).then(e=>{var t;i.current=null!=(t=e.Howl)?t:e.default.Howl;try{r(new i.current({src:a}))}catch(e){}}).catch(()=>{})}),(0,j.useUpdateEffect)(()=>{if(i.current)try{r(new i.current({src:a}))}catch(e){}},[a]),{play:(0,t.useCallback)(()=>{s&&s.play()},[s])}}("https://cdn.lu.ma/sound/chat-notification.mp3"),n=(0,M.useRandomSeed)();(0,w.usePolling)(()=>{let e=C.LocalStorage.get({key:T,schema:S});if(!e||e.tabId===n.toString()||document.hasFocus()||Math.abs(_.DateTime.fromISO(e.updated).diffNow().as("seconds"))>3)return void C.LocalStorage.save({key:T,schema:S,value:{updated:_.DateTime.now().toISO(),tabId:n.toString()}})},{seconds:1});let o=(0,t.useRef)(i);return(0,t.useEffect)(()=>{o.current=i},[i]),{handleUpdate:(0,t.useCallback)(e=>{var a;if(!(e.chat_messages.filter(e=>!e.deleted_at&&!e.context.skip_as_last_message).length>0))return;let t=o.current.find(a=>a.api_id===e.chat_conversation_api_id);if((null==t?void 0:t.mute_until)&&_.DateTime.fromISO(t.mute_until)>_.DateTime.now())return;let i=C.LocalStorage.get({key:T,schema:S}),l=!i||i.tabId===n.toString(),d=null==(a=e.chat_messages[0])?void 0:a.author,c=(null==d?void 0:d.user_api_id)===(null==s?void 0:s.api_id),u=document.hasFocus(),h=e.chat_messages.some(e=>null!=e.user_api_id);l&&!u&&!c&&h&&e.is_new_message&&r()},[null==s?void 0:s.api_id,r,n])}})({conversations:s.conversations}),c=(0,t.useCallback)(async()=>{try{let{conversations:e}=await p.APIClient.get("/chat/conversations");r(a=>({...a,conversations:e,loading:!1}))}catch(e){}},[r]);(0,t.useEffect)(()=>{i||c()},[i]),(0,j.useUpdateEffect)(()=>{r({conversations:[],loading:!0}),i||c()},[null==n?void 0:n.api_id]);let h=(0,t.useCallback)(e=>{r(a=>(0,b.produce)(a,a=>{let t=a.conversations.find(a=>a.conversation.api_id===e.api_id);t&&(t.conversation=e)}))},[r]),f=(0,t.useCallback)(e=>{let a=e.filter(e=>!e.context.skip_as_last_message),t=a[a.length-1];if(!t)return;let i=t.chat_conversation_api_id;r(e=>(0,b.produce)(e,e=>{let a=e.conversations.find(e=>e.conversation.api_id===i);a||c(),a&&(!a.last_message||a.last_message.sent_at<t.sent_at)&&(a.last_message=t)}))},[r,c]),g=(0,t.useCallback)(e=>{let a=e.chat_conversation_api_id;r(t=>(0,b.produce)(t,t=>{let i=t.conversations.find(e=>e.conversation.api_id===a);i&&(i.my_participant.user_api_id===e.user_api_id?i.my_participant={...e,last_read_chat_message_sent_at:N(i.my_participant.last_read_chat_message_sent_at,e.last_read_chat_message_sent_at)}:"direct"===i.type&&i.other_participant.user_api_id===e.user_api_id&&(i.other_participant={...e,last_read_chat_message_sent_at:N(i.other_participant.last_read_chat_message_sent_at,e.last_read_chat_message_sent_at)}))}))},[r]),v=(0,t.useCallback)(e=>{r(a=>(0,b.produce)(a,a=>{a.conversations=(0,o.uniqBy)([e,...a.conversations],e=>e.conversation.api_id)}))},[r]),x=(0,t.useCallback)(e=>{r(a=>(0,b.produce)(a,a=>{let t=a.conversations.find(a=>a.conversation.api_id===e);t&&(t.my_participant.last_read_chat_message_sent_at=N(t.my_participant.last_read_chat_message_sent_at,_.DateTime.now().toUTC().toISO()))}))},[r]),y=(0,t.useCallback)(e=>{f([e])},[f]),A=(0,t.useCallback)(async e=>{e.type===d.RealTimeUpdateType.ChatConversationUpsert?h(e.chat_conversation):e.type===d.RealTimeUpdateType.ChatMessagesBatch?(f(e.chat_messages),l(e)):e.type===d.RealTimeUpdateType.ChatParticipantUpsert&&g(e.chat_participant)},[h,f,g,l]),I=(0,t.useCallback)(()=>{console.error("Failed to subscribe to real time updates")},[]);(0,m.useCentrifugeSubscription)({channel:(null==n?void 0:n.api_id)&&!i?(0,d.getRealTimeChannelForUserChat)(n):void 0,onUpdate:A,onError:I});let P=(0,t.useMemo)(()=>(0,o.orderBy)(s.conversations,[{transform:e=>{var a,t;return null!=(t=null==(a=e.last_message)?void 0:a.sent_at)?t:""},direction:"desc"}]),[s.conversations]),O=(0,t.useMemo)(()=>new Set(s.conversations.filter(e=>{let{my_participant:a,last_message:t}=e;return!!t&&t.user_api_id!==(null==n?void 0:n.api_id)&&(!a.last_read_chat_message_sent_at||a.last_read_chat_message_sent_at<t.sent_at)}).map(e=>e.conversation.api_id)),[s.conversations,n]);return{loading:s.loading,conversations:P,addConversation:v,markConversationRead:x,addMessage:y,refresh:c,unreadConversations:O}})({pause:!P}),{conversations:B}=F,W=B&&B.length>0||L,V=(0,t.useCallback)(e=>{U(e||null),E(!0),D(null)},[E,U,D]),H=(0,t.useCallback)(()=>{E(!1)},[E]);(0,t.useEffect)(()=>{U(null),H()},[null==P?void 0:P.api_id,H]);let G=(0,s.useStableObject)(null!=P?P:null),Y=O({conversationApiId:R}),q=Y.onMessages,K=(0,t.useCallback)(async e=>{e.type===d.RealTimeUpdateType.ChatMessagesBatch&&q(e.chat_messages)},[q]);return(0,m.useCentrifugeSubscription)({channel:(0,d.getRealTimeChannelForUserChat)(P),onUpdate:K}),(0,a.jsxs)(A.Provider,{value:{currentUser:G,conversationsState:F,isChatWindowOpen:L,closeChatWindow:H,openConversation:V,replyingToMessage:z,setReplyingToMessage:D,messages:Y,openConversationApiId:R},children:[(0,a.jsx)(c.PresenceProvider,{pause:r||!W,presenceFetcher:async()=>{try{return await p.APIClient.get("/presence/bootstrap")}catch(e){return{users:[]}}},user:G}),B.length>0&&!r&&(0,a.jsx)(h.RegisterSearchCategory,{category:{key:"chat",name:I(l.CT.Chat),items:B.map(e=>({key:e.conversation.api_id,icon:(0,a.jsx)(g.ChatConversationAvatar,{info:e,px:24}),title:(0,x.getConversationName)({info:e,t:I}),onClick:async()=>{setTimeout(()=>{V(e.conversation.api_id)},0)}})),position:"chat"}}),f,!r&&W&&y&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(v.ChatOverlay,{isWindowOpen:L,closeWindow:()=>E(!1),openConversationApiId:R,openConversation:V})})]})},P=(0,r.createUseAppContext)(A),O=e=>{let{conversationApiId:a}=e,{entries:s,hasMore:r,loadMore:n,fetching:l,status:d,fetchFirstPage:c,addEntries:u,updateEntries:h}=(0,f.usePaginatedRequest)({path:"/chat/conversation/get-messages",args:{chat_conversation_api_id:a},pause:!a});(0,i.useOnFocus)(c);let p=(0,t.useCallback)(e=>{let t=e.filter(e=>e.chat_conversation_api_id===a);0!==t.length&&u(t)},[u,a]),m=(0,t.useCallback)(e=>{h(a=>a.api_id!==e?a:{...a,deleted_at:new Date().toISOString()})},[h]),g=(0,t.useMemo)(()=>(0,o.orderBy)(s.filter(e=>!e.deleted_at),[{transform:e=>"error"in e&&e.error?"zzzz"+e.sent_at:e.sent_at,direction:"desc"},{transform:e=>{var a;return e.image||(null==(a=e.media)?void 0:a.length)?-1:1}},{transform:e=>e.api_id}]),[s]);return s.length>0&&s[0].chat_conversation_api_id!==a?{entries:[],hasOlder:!1,fetchOlder:n,isLoadingOlderMessages:!1,isLoadingInitialMessages:!0,onDeleteMessage:m,onMessages:p}:{entries:g,hasOlder:r,fetchOlder:n,isLoadingOlderMessages:l,isLoadingInitialMessages:"initial-load"===d,onDeleteMessage:m,onMessages:p}}}]);

//# debugId=d6051e81-8224-d602-78b1-cd8f658e5d1d
//# sourceMappingURL=d6ebbd2a5e9bdee5.js.map